<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–∏–∑–∞–π–Ω–µ—Ä –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Roboto:wght@400;700&family=Playfair+Display:wght@400;700&family=Montserrat:wght@400;700&family=Open+Sans:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <div id="root"></div>

    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- html2canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <!-- JSZip -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    
    <!-- jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        const PresentationDesigner = () => {
            const [mode, setMode] = useState('import');
            const [slides, setSlides] = useState([]);
            const [currentSlideIndex, setCurrentSlideIndex] = useState(0);
            const [changedSettings, setChangedSettings] = useState({});
            const [isStyleSectionOpen, setIsStyleSectionOpen] = useState(false);
            const [aspectRatio, setAspectRatio] = useState('16:9');
            const [showImageModal, setShowImageModal] = useState(false);
            const [showDeleteModal, setShowDeleteModal] = useState(false);
            const [pendingImage, setPendingImage] = useState(null);
            const [isExporting, setIsExporting] = useState(false);
            const [exportProgress, setExportProgress] = useState(0);
            
            const slideRef = useRef(null);
            const importTextRef = useRef(null);
            const fileInputRef = useRef(null);

            useEffect(() => {
                setIsStyleSectionOpen(currentSlideIndex < 2);
            }, [mode, currentSlideIndex]);

            const fonts = [
                { name: 'Inter', value: 'Inter, sans-serif' },
                { name: 'Roboto', value: 'Roboto, sans-serif' },
                { name: 'Playfair Display', value: 'Playfair Display, serif' },
                { name: 'Montserrat', value: 'Montserrat, sans-serif' },
                { name: 'Open Sans', value: 'Open Sans, sans-serif' }
            ];

            const markSettingChanged = (settingName) => {
                setChangedSettings(prev => ({
                    ...prev,
                    [settingName]: true
                }));
            };

            const clearSettingChange = (settingName) => {
                setChangedSettings(prev => {
                    const newState = { ...prev };
                    delete newState[settingName];
                    return newState;
                });
            };

            const applyToCurrentSlide = (settings) => {
                const updatedSlides = [...slides];
                updatedSlides[currentSlideIndex] = {
                    ...updatedSlides[currentSlideIndex],
                    ...settings
                };
                setSlides(updatedSlides);
            };

            const applyToCurrentAndFollowing = (settings) => {
                const updatedSlides = slides.map((slide, index) => {
                    if (index >= currentSlideIndex) {
                        return { ...slide, ...settings };
                    }
                    return slide;
                });
                setSlides(updatedSlides);
            };

            const applyToAllSlides = (settings) => {
                const updatedSlides = slides.map(slide => ({
                    ...slide,
                    ...settings
                }));
                setSlides(updatedSlides);
            };

            const parseSlides = (text) => {
                const slidePattern = /^(\d+)\s*$/gm;
                const parts = text.split(slidePattern).filter(part => part.trim() !== '');
                
                const parsedSlides = [];
                
                for (let i = 0; i < parts.length; i += 2) {
                    if (i + 1 < parts.length) {
                        const content = parts[i].trim();
                        const slideNumber = parts[i + 1];
                        
                        const lines = content.split('\n').filter(line => line.trim() !== '');
                        
                        let title = '';
                        let mainText = '';
                        let accentText = '';
                        let secondaryText = '';
                        
                        if (lines.length > 0) {
                            title = lines[0];
                            
                            let accentIndex = -1;
                            for (let j = 1; j < lines.length; j++) {
                                if (lines[j].trim().endsWith(':')) {
                                    accentText = lines[j];
                                    accentIndex = j;
                                    break;
                                }
                            }
                            
                            if (accentIndex > 0) {
                                mainText = lines.slice(1, accentIndex).join('\n');
                                if (accentIndex < lines.length - 1) {
                                    secondaryText = lines.slice(accentIndex + 1).join('\n');
                                }
                            } else {
                                mainText = lines.slice(1).join('\n');
                            }
                        }
                        
                        parsedSlides.push({
                            id: slideNumber,
                            title: title,
                            mainText: mainText,
                            accentText: accentText,
                            secondaryText: secondaryText,
                            titleAlign: 'left',
                            mainTextAlign: 'left',
                            accentAlign: 'left',
                            secondaryTextAlign: 'left',
                            bgType: 'solid',
                            bgColor1: '#1e40af',
                            bgColor2: '#7c3aed',
                            bgImage: null,
                            fontFamily: 'Inter',
                            titleFontSize: 130,
                            mainFontSize: 75,
                            accentFontSize: 70,
                            accentBgColor: '#fbbf24',
                            textColor: '#ffffff',
                            accentTextColor: '#000000'
                        });
                    }
                }
                
                return parsedSlides;
            };

            const handleImport = () => {
                const text = importTextRef.current.value;
                if (text.trim()) {
                    const parsedSlides = parseSlides(text);
                    setSlides(parsedSlides);
                    setMode('edit');
                    setCurrentSlideIndex(0);
                }
            };

            const updateCurrentSlide = (field, value) => {
                const updatedSlides = [...slides];
                updatedSlides[currentSlideIndex] = {
                    ...updatedSlides[currentSlideIndex],
                    [field]: value
                };
                setSlides(updatedSlides);
            };

            const currentSlide = slides[currentSlideIndex] || {};

            const getSlideBackground = () => {
                const bgType = currentSlide.bgType || 'solid';
                const bgImage = currentSlide.bgImage;
                const bgColor1 = currentSlide.bgColor1 || '#1e40af';
                const bgColor2 = currentSlide.bgColor2 || '#7c3aed';
                
                if (bgType === 'image' && bgImage) {
                    return {
                        backgroundImage: `url(${bgImage})`,
                        backgroundSize: 'cover',
                        backgroundPosition: 'center',
                        backgroundRepeat: 'no-repeat'
                    };
                } else if (bgType === 'solid') {
                    return { backgroundColor: bgColor1 };
                } else {
                    return {
                        backgroundImage: `linear-gradient(135deg, ${bgColor1} 0%, ${bgColor2} 100%)`
                    };
                }
            };

            const handleImageSelect = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        setPendingImage(event.target.result);
                        setShowImageModal(true);
                    };
                    reader.readAsDataURL(file);
                }
                e.target.value = '';
            };

            const applyImageToCurrentSlide = () => {
                const settings = {
                    bgImage: pendingImage,
                    bgType: 'image'
                };
                applyToCurrentSlide(settings);
                setShowImageModal(false);
                setPendingImage(null);
            };

            const applyImageToAllSlides = () => {
                const settings = {
                    bgImage: pendingImage,
                    bgType: 'image'
                };
                applyToAllSlides(settings);
                setShowImageModal(false);
                setPendingImage(null);
            };

            const applyImageToFollowingSlides = () => {
                const settings = {
                    bgImage: pendingImage,
                    bgType: 'image'
                };
                applyToCurrentAndFollowing(settings);
                setShowImageModal(false);
                setPendingImage(null);
            };

            const cancelImageUpload = () => {
                setShowImageModal(false);
                setPendingImage(null);
            };

            const removeBackgroundImage = (applyTo) => {
                const settings = {
                    bgImage: null,
                    bgType: 'solid'
                };
                if (applyTo === 'all') {
                    applyToAllSlides(settings);
                } else if (applyTo === 'following') {
                    applyToCurrentAndFollowing(settings);
                } else {
                    applyToCurrentSlide(settings);
                }
            };

            const getAspectRatioClass = () => {
                switch(aspectRatio) {
                    case '16:9':
                        return 'aspect-video';
                    case '1:1':
                        return 'aspect-square';
                    case '4:3':
                        return 'aspect-[4/3]';
                    default:
                        return 'aspect-video';
                }
            };

            const getCanvasDimensions = () => {
                switch(aspectRatio) {
                    case '16:9':
                        return { width: 1920, height: 1080 };
                    case '1:1':
                        return { width: 1080, height: 1080 };
                    case '4:3':
                        return { width: 1440, height: 1080 };
                    default:
                        return { width: 1920, height: 1080 };
                }
            };

            const AlignmentToggle = ({ value, onChange }) => {
                return (
                    <div className="flex gap-1 bg-gray-100 p-1 rounded-md">
                        <button
                            onClick={() => onChange('left')}
                            className={`px-3 py-1 rounded transition-colors ${
                                value === 'left' 
                                    ? 'bg-white shadow-sm text-blue-600' 
                                    : 'hover:bg-gray-50 text-gray-600'
                            }`}
                            title="–ü–æ –ª–µ–≤–æ–º—É –∫—Ä–∞—é"
                        >
                            ‚Üê
                        </button>
                        <button
                            onClick={() => onChange('center')}
                            className={`px-3 py-1 rounded transition-colors ${
                                value === 'center' 
                                    ? 'bg-white shadow-sm text-blue-600' 
                                    : 'hover:bg-gray-50 text-gray-600'
                            }`}
                            title="–ü–æ —Ü–µ–Ω—Ç—Ä—É"
                        >
                            ‚Üî
                        </button>
                    </div>
                );
            };

            const FontSizeSlider = ({ label, value, onChange, min, max }) => {
                return (
                    <div>
                        <div className="flex justify-between items-center mb-2">
                            <label className="block text-sm font-medium text-gray-600">
                                {label}
                            </label>
                            <span className="text-sm font-semibold text-blue-600 bg-blue-50 px-2 py-1 rounded">
                                {value}px
                            </span>
                        </div>
                        <input
                            type="range"
                            min={min}
                            max={max}
                            value={value}
                            onChange={(e) => onChange(parseInt(e.target.value))}
                            className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-600"
                        />
                        <div className="flex justify-between text-xs text-gray-400 mt-1">
                            <span>{min}px</span>
                            <span>{max}px</span>
                        </div>
                    </div>
                );
            };

            const ApplyButtons = ({ onApplyCurrent, onApplyAll, settingKey, settingName }) => {
                if (!changedSettings[settingKey]) return null;
                
                return (
                    <div className="mt-3 p-4 bg-gradient-to-r from-amber-50 to-orange-50 rounded-lg border-2 border-amber-400 shadow-lg">
                        <p className="text-sm text-gray-800 mb-3 font-semibold flex items-center gap-2">
                            <span className="inline-block w-2 h-2 bg-amber-500 rounded-full animate-pulse"></span>
                            –ü—Ä–∏–º–µ–Ω–∏—Ç—å {settingName || '–∏–∑–º–µ–Ω–µ–Ω–∏—è'}?
                        </p>
                        <div className="space-y-2">
                            <div className="flex gap-2">
                                <button
                                    onClick={() => {
                                        onApplyCurrent();
                                        clearSettingChange(settingKey);
                                    }}
                                    className="flex-1 px-4 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all text-sm font-semibold shadow-md hover:shadow-lg transform hover:scale-105"
                                >
                                    –¢–æ–ª—å–∫–æ —ç—Ç–æ—Ç —Å–ª–∞–π–¥
                                </button>
                                <button
                                    onClick={() => {
                                        onApplyAll();
                                        clearSettingChange(settingKey);
                                    }}
                                    className="flex-1 px-4 py-2.5 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-all text-sm font-semibold shadow-md hover:shadow-lg transform hover:scale-105"
                                >
                                    –≠—Ç–æ—Ç –∏ —Å–ª–µ–¥—É—é—â–∏–µ
                                </button>
                            </div>
                            <button
                                onClick={() => clearSettingChange(settingKey)}
                                className="w-full px-4 py-2 bg-gray-100 text-gray-600 rounded-lg hover:bg-gray-200 transition-colors text-sm font-medium border border-gray-300"
                            >
                                –ù–µ –ø—Ä–∏–º–µ–Ω—è—Ç—å
                            </button>
                        </div>
                    </div>
                );
            };

            const renderSlideToCanvas = async (slide, slideIndex) => {
                const originalIndex = currentSlideIndex;
                setCurrentSlideIndex(slideIndex);
                
                await new Promise(resolve => setTimeout(resolve, 100));
                
                if (!slideRef.current) return null;
                
                try {
                    const dimensions = getCanvasDimensions();
                    const scale = dimensions.width / slideRef.current.offsetWidth;
                    
                    const canvas = await html2canvas(slideRef.current, {
                        scale: scale,
                        width: slideRef.current.offsetWidth,
                        height: slideRef.current.offsetHeight,
                        backgroundColor: null,
                        logging: false,
                        useCORS: true,
                        allowTaint: true
                    });
                    
                    setCurrentSlideIndex(originalIndex);
                    return canvas;
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–µ —Å–ª–∞–π–¥–∞:', error);
                    setCurrentSlideIndex(originalIndex);
                    return null;
                }
            };

            const exportCurrentSlide = async () => {
                if (!slideRef.current) return;
                
                try {
                    const dimensions = getCanvasDimensions();
                    const scale = dimensions.width / slideRef.current.offsetWidth;
                    
                    const canvas = await html2canvas(slideRef.current, {
                        scale: scale,
                        width: slideRef.current.offsetWidth,
                        height: slideRef.current.offsetHeight,
                        backgroundColor: null,
                        logging: false,
                        useCORS: true,
                        allowTaint: true
                    });
                    
                    canvas.toBlob((blob) => {
                        const url = URL.createObjectURL(blob);
                        const link = document.createElement('a');
                        link.download = `slide-${currentSlide.id || currentSlideIndex + 1}.png`;
                        link.href = url;
                        link.click();
                        URL.revokeObjectURL(url);
                    });
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ:', error);
                    alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
                }
            };

            const exportAllSlidesAsZip = async () => {
                setIsExporting(true);
                setExportProgress(0);
                
                try {
                    const zip = new JSZip();
                    const folder = zip.folder('slides');
                    
                    for (let i = 0; i < slides.length; i++) {
                        setExportProgress(Math.round(((i + 1) / slides.length) * 100));
                        
                        const canvas = await renderSlideToCanvas(slides[i], i);
                        if (canvas) {
                            const blob = await new Promise(resolve => canvas.toBlob(resolve));
                            folder.file(`slide-${slides[i].id || i + 1}.png`, blob);
                        }
                    }
                    
                    const content = await zip.generateAsync({ type: 'blob' });
                    const url = URL.createObjectURL(content);
                    const link = document.createElement('a');
                    link.download = 'presentation-slides.zip';
                    link.href = url;
                    link.click();
                    URL.revokeObjectURL(url);
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ ZIP:', error);
                    alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∞—Ä—Ö–∏–≤–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
                } finally {
                    setIsExporting(false);
                    setExportProgress(0);
                }
            };

            const exportAllSlidesAsPDF = async () => {
                setIsExporting(true);
                setExportProgress(0);
                
                try {
                    const dimensions = getCanvasDimensions();
                    const { jsPDF } = window.jspdf;
                    const pdf = new jsPDF({
                        orientation: dimensions.width > dimensions.height ? 'landscape' : 'portrait',
                        unit: 'px',
                        format: [dimensions.width, dimensions.height]
                    });
                    
                    for (let i = 0; i < slides.length; i++) {
                        setExportProgress(Math.round(((i + 1) / slides.length) * 100));
                        
                        const canvas = await renderSlideToCanvas(slides[i], i);
                        if (canvas) {
                            const imgData = canvas.toDataURL('image/png');
                            
                            if (i > 0) {
                                pdf.addPage([dimensions.width, dimensions.height]);
                            }
                            
                            pdf.addImage(imgData, 'PNG', 0, 0, dimensions.width, dimensions.height);
                        }
                    }
                    
                    pdf.save('presentation-slides.pdf');
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ PDF:', error);
                    alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ PDF. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
                } finally {
                    setIsExporting(false);
                    setExportProgress(0);
                }
            };

            const ImageApplyModal = () => {
                if (!showImageModal) return null;
                
                return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                        <div className="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                            <div className="p-6">
                                <h2 className="text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                                    üñºÔ∏è –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–æ–Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                                </h2>
                                
                                <div className="mb-6">
                                    <p className="text-gray-600 mb-4">
                                        –í—ã–±–µ—Ä–∏—Ç–µ, –∫–∞–∫ –ø—Ä–∏–º–µ–Ω–∏—Ç—å —ç—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ:
                                    </p>
                                    
                                    {pendingImage && (
                                        <div className="mb-4 rounded-lg overflow-hidden border-2 border-gray-300">
                                            <img 
                                                src={pendingImage} 
                                                alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä" 
                                                className="w-full h-48 object-cover"
                                            />
                                        </div>
                                    )}
                                </div>
                                
                                <div className="space-y-3">
                                    <button
                                        onClick={applyImageToCurrentSlide}
                                        className="w-full px-6 py-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all font-semibold shadow-md hover:shadow-lg transform hover:scale-105 flex items-center justify-center gap-2"
                                    >
                                        <span>üìÑ</span>
                                        –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ –¥–ª—è —ç—Ç–æ–≥–æ —Å–ª–∞–π–¥–∞ ({currentSlideIndex + 1})
                                    </button>
                                    
                                    <button
                                        onClick={applyImageToFollowingSlides}
                                        className="w-full px-6 py-4 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-all font-semibold shadow-md hover:shadow-lg transform hover:scale-105 flex items-center justify-center gap-2"
                                    >
                                        <span>‚û°Ô∏è</span>
                                        –ü—Ä–∏–º–µ–Ω–∏—Ç—å –¥–ª—è —ç—Ç–æ–≥–æ –∏ —Å–ª–µ–¥—É—é—â–∏—Ö
                                    </button>
                                    
                                    <button
                                        onClick={cancelImageUpload}
                                        className="w-full px-6 py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors font-medium border border-gray-300"
                                    >
                                        ‚ùå –û—Ç–º–µ–Ω–∏—Ç—å
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            const ImageDeleteModal = () => {
                if (!showDeleteModal) return null;
                
                return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                        <div className="bg-white rounded-xl shadow-2xl max-w-md w-full">
                            <div className="p-6">
                                <h2 className="text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                                    üóëÔ∏è –£–¥–∞–ª–∏—Ç—å —Ñ–æ–Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                                </h2>
                                
                                <p className="text-gray-600 mb-6">
                                    –í—ã–±–µ—Ä–∏—Ç–µ –æ–±–ª–∞—Å—Ç—å —É–¥–∞–ª–µ–Ω–∏—è:
                                </p>
                                
                                <div className="space-y-3">
                                    <button
                                        onClick={() => {
                                            removeBackgroundImage('current');
                                            setShowDeleteModal(false);
                                        }}
                                        className="w-full px-6 py-3 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition-all font-semibold border-2 border-red-200 flex items-center justify-center gap-2"
                                    >
                                        <span>üìÑ</span>
                                        –£–¥–∞–ª–∏—Ç—å —Ç–æ–ª—å–∫–æ –Ω–∞ —ç—Ç–æ–º —Å–ª–∞–π–¥–µ
                                    </button>
                                    
                                    <button
                                        onClick={() => {
                                            removeBackgroundImage('following');
                                            setShowDeleteModal(false);
                                        }}
                                        className="w-full px-6 py-3 bg-orange-50 text-orange-700 rounded-lg hover:bg-orange-100 transition-all font-semibold border-2 border-orange-200 flex items-center justify-center gap-2"
                                    >
                                        <span>‚û°Ô∏è</span>
                                        –£–¥–∞–ª–∏—Ç—å –Ω–∞ —ç—Ç–æ–º –∏ —Å–ª–µ–¥—É—é—â–∏—Ö
                                    </button>
                                    
                                    <button
                                        onClick={() => {
                                            removeBackgroundImage('all');
                                            setShowDeleteModal(false);
                                        }}
                                        className="w-full px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-all font-semibold shadow-md hover:shadow-lg flex items-center justify-center gap-2"
                                    >
                                        <span>üóëÔ∏è</span>
                                        –£–¥–∞–ª–∏—Ç—å —Å–æ –≤—Å–µ—Ö —Å–ª–∞–π–¥–æ–≤
                                    </button>
                                    
                                    <button
                                        onClick={() => setShowDeleteModal(false)}
                                        className="w-full px-6 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors font-medium border border-gray-300"
                                    >
                                        –û—Ç–º–µ–Ω–∞
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            const ExportProgressModal = () => {
                if (!isExporting) return null;
                
                return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                        <div className="bg-white rounded-xl shadow-2xl p-8 max-w-md w-full mx-4">
                            <h3 className="text-xl font-bold text-gray-800 mb-4 text-center">
                                ‚è≥ –≠–∫—Å–ø–æ—Ä—Ç —Å–ª–∞–π–¥–æ–≤...
                            </h3>
                            <div className="mb-4">
                                <div className="w-full bg-gray-200 rounded-full h-4 overflow-hidden">
                                    <div 
                                        className="bg-blue-600 h-full transition-all duration-300 ease-out"
                                        style={{ width: `${exportProgress}%` }}
                                    />
                                </div>
                            </div>
                            <p className="text-center text-gray-600 font-semibold">
                                {exportProgress}%
                            </p>
                            <p className="text-center text-sm text-gray-500 mt-2">
                                –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ...
                            </p>
                        </div>
                    </div>
                );
            };

            if (mode === 'import') {
                return (
                    <div className="min-h-screen bg-gray-50 p-4">
                        <div className="max-w-4xl mx-auto">
                            <div className="bg-white rounded-xl shadow-lg p-8">
                                <h1 className="text-3xl font-bold text-gray-800 mb-2 flex items-center gap-2">
                                    üìÑ –ò–º–ø–æ—Ä—Ç —Å–ª–∞–π–¥–æ–≤
                                </h1>
                                <p className="text-gray-600 mb-6">
                                    –í—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏. –ö–∞–∂–¥—ã–π —Å–ª–∞–π–¥ –¥–æ–ª–∂–µ–Ω –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å—Å—è –Ω–æ–º–µ—Ä–æ–º.
                                </p>
                                
                                <div className="mb-6">
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        –¢–µ–∫—Å—Ç –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏
                                    </label>
                                    <textarea
                                        ref={importTextRef}
                                        className="w-full h-96 px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent font-mono text-sm"
                                        placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ —Ç–µ–∫—Å—Ç –≤–∞—à–µ–π –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏...&#10;&#10;–ù–∞–ø—Ä–∏–º–µ—Ä:&#10;–ü—Å–∏—Ö–æ–ª–æ–≥–∏—è –ª–∏—á–Ω–æ—Å—Ç–∏:&#10;—á—Ç–æ –æ–Ω–∞ –∏–∑—É—á–∞–µ—Ç;&#10;–∫–∞–∫–∏–µ –µ—Å—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è.&#10;1&#10;&#10;–ö–∞–∂–¥—ã–π –∏–∑ –Ω–∞—Å —É–Ω–∏–∫–∞–ª–µ–Ω.&#10;–ò–º–µ–Ω–Ω–æ –ª–∏—á–Ω–æ—Å—Ç—å –¥–µ–ª–∞–µ—Ç —á–µ–ª–æ–≤–µ–∫–∞ —Ç–∞–∫–∏–º...&#10;2"
                                    />
                                </div>
                                
                                <button
                                    onClick={handleImport}
                                    className="w-full bg-blue-600 text-white py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center gap-2 font-semibold text-lg shadow-md hover:shadow-lg"
                                >
                                    ‚¨ÜÔ∏è –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–ª–∞–π–¥—ã
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gray-50 p-4">
                    <ImageApplyModal />
                    <ImageDeleteModal />
                    <ExportProgressModal />
                    
                    <div className="max-w-7xl mx-auto">
                        <div className="bg-white rounded-xl shadow-lg p-6 mb-6">
                            <div className="flex justify-between items-center mb-6">
                                <h1 className="text-2xl font-bold text-gray-800 flex items-center gap-2">
                                    üìä –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ª–∞–π–¥–æ–≤ ({slides.length} —à—Ç.)
                                </h1>
                                <button
                                    onClick={() => setMode('import')}
                                    className="px-4 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition-colors flex items-center gap-2"
                                >
                                    ‚Üê –ù–∞–∑–∞–¥ –∫ –∏–º–ø–æ—Ä—Ç—É
                                </button>
                            </div>
                            
                            <div className="mb-6 bg-gray-50 p-4 rounded-lg">
                                <div className="flex items-center justify-between mb-3">
                                    <button
                                        onClick={() => setCurrentSlideIndex(Math.max(0, currentSlideIndex - 1))}
                                        disabled={currentSlideIndex === 0}
                                        className="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors flex items-center gap-2"
                                    >
                                        ‚óÄ –ü—Ä–µ–¥—ã–¥—É—â–∏–π
                                    </button>
                                    
                                    <span className="text-lg font-semibold text-gray-700">
                                        –°–ª–∞–π–¥ {currentSlideIndex + 1} –∏–∑ {slides.length}
                                    </span>
                                    
                                    <button
                                        onClick={() => setCurrentSlideIndex(Math.min(slides.length - 1, currentSlideIndex + 1))}
                                        disabled={currentSlideIndex === slides.length - 1}
                                        className="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors flex items-center gap-2"
                                    >
                                        –°–ª–µ–¥—É—é—â–∏–π ‚ñ∂
                                    </button>
                                </div>
                                
                                <div className="flex gap-2 overflow-x-auto pb-2">
                                    {slides.map((slide, index) => (
                                        <button
                                            key={index}
                                            onClick={() => setCurrentSlideIndex(index)}
                                            className={`flex-shrink-0 px-3 py-2 rounded-md text-sm font-medium transition-colors ${
                                                index === currentSlideIndex
                                                    ? 'bg-blue-600 text-white'
                                                    : 'bg-white text-gray-700 hover:bg-gray-100'
                                            }`}
                                        >
                                            {index + 1}
                                        </button>
                                    ))}
                                </div>
                            </div>
                            
                            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <div className="space-y-4">
                                    {currentSlideIndex === 0 && (
                                        <div className="bg-gradient-to-r from-purple-50 to-blue-50 p-4 rounded-lg border border-purple-200">
                                            <h3 className="font-semibold text-gray-700 mb-3">
                                                –§–æ—Ä–º–∞—Ç —Å–ª–∞–π–¥–æ–≤ (–¥–ª—è –≤—Å–µ–π –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏)
                                            </h3>
                                            
                                            <div className="space-y-3">
                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                                        –§–æ—Ä–º–∞—Ç —Å–ª–∞–π–¥–∞
                                                    </label>
                                                    <select
                                                        value={aspectRatio}
                                                        onChange={(e) => setAspectRatio(e.target.value)}
                                                        className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 bg-white"
                                                    >
                                                        <option value="16:9">16:9 (–®–∏—Ä–æ–∫–æ—Ñ–æ—Ä–º–∞—Ç–Ω—ã–π)</option>
                                                        <option value="1:1">1:1 (–ö–≤–∞–¥—Ä–∞—Ç–Ω—ã–π)</option>
                                                        <option value="4:3">4:3 (–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π)</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    )}

                                    <div className="bg-gray-50 p-4 rounded-lg">
                                        <h3 className="font-semibold text-gray-700 mb-3 flex items-center gap-2">
                                            ‚úçÔ∏è –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–ª–∞–π–¥–∞ {currentSlideIndex + 1}
                                        </h3>
                                        
                                        <div className="space-y-3">
                                            <div>
                                                <div className="flex justify-between items-center mb-1">
                                                    <label className="block text-sm font-medium text-gray-600">
                                                        –ó–∞–≥–æ–ª–æ–≤–æ–∫
                                                    </label>
                                                    <AlignmentToggle 
                                                        value={currentSlide.titleAlign} 
                                                        onChange={(value) => updateCurrentSlide('titleAlign', value)} 
                                                    />
                                                </div>
                                                <textarea
                                                    value={currentSlide.title || ''}
                                                    onChange={(e) => updateCurrentSlide('title', e.target.value)}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                    rows="2"
                                                    placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫"
                                                />
                                            </div>
                                            
                                            <div>
                                                <div className="flex justify-between items-center mb-1">
                                                    <label className="block text-sm font-medium text-gray-600">
                                                        –û—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç
                                                    </label>
                                                    <AlignmentToggle 
                                                        value={currentSlide.mainTextAlign} 
                                                        onChange={(value) => updateCurrentSlide('mainTextAlign', value)} 
                                                    />
                                                </div>
                                                <textarea
                                                    value={currentSlide.mainText || ''}
                                                    onChange={(e) => updateCurrentSlide('mainText', e.target.value)}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                    rows="4"
                                                    placeholder="–í–≤–µ–¥–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç"
                                                />
                                            </div>
                                            
                                            <div>
                                                <div className="flex justify-between items-center mb-1">
                                                    <label className="block text-sm font-medium text-gray-600">
                                                        –ê–∫—Ü–µ–Ω—Ç–Ω—ã–π —Ç–µ–∫—Å—Ç
                                                    </label>
                                                    <AlignmentToggle 
                                                        value={currentSlide.accentAlign} 
                                                        onChange={(value) => updateCurrentSlide('accentAlign', value)} 
                                                    />
                                                </div>
                                                <textarea
                                                    value={currentSlide.accentText || ''}
                                                    onChange={(e) => updateCurrentSlide('accentText', e.target.value)}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                    rows="2"
                                                    placeholder="–¢–µ–∫—Å—Ç –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è"
                                                />
                                            </div>
                                            
                                            <div>
                                                <div className="flex justify-between items-center mb-1">
                                                    <label className="block text-sm font-medium text-gray-600">
                                                        –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç
                                                    </label>
                                                    <AlignmentToggle 
                                                        value={currentSlide.secondaryTextAlign} 
                                                        onChange={(value) => updateCurrentSlide('secondaryTextAlign', value)} 
                                                    />
                                                </div>
                                                <textarea
                                                    value={currentSlide.secondaryText || ''}
                                                    onChange={(e) => updateCurrentSlide('secondaryText', e.target.value)}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                    rows="4"
                                                    placeholder="–¢–µ–∫—Å—Ç –ø–æ—Å–ª–µ –∞–∫—Ü–µ–Ω—Ç–∞"
                                                />
                                            </div>
                                        </div>
                                    </div>

                                    <div className="bg-gradient-to-br from-blue-50 to-indigo-50 p-4 rounded-lg border border-blue-100">
                                        <h3 className="font-semibold text-gray-700 mb-3 flex items-center gap-2">
                                            üìè –†–∞–∑–º–µ—Ä—ã —à—Ä–∏—Ñ—Ç–æ–≤
                                        </h3>
                                        
                                        <div className="space-y-4">
                                            <div>
                                                <FontSizeSlider
                                                    label="–†–∞–∑–º–µ—Ä –∑–∞–≥–æ–ª–æ–≤–∫–∞"
                                                    value={currentSlide.titleFontSize || 130}
                                                    onChange={(value) => {
                                                        updateCurrentSlide('titleFontSize', value);
                                                        markSettingChanged('titleFontSize');
                                                    }}
                                                    min={40}
                                                    max={150}
                                                />
                                                <ApplyButtons
                                                    settingKey="titleFontSize"
                                                    settingName="—Ä–∞–∑–º–µ—Ä –∑–∞–≥–æ–ª–æ–≤–∫–∞"
                                                    onApplyCurrent={() => {}}
                                                    onApplyAll={() => applyToCurrentAndFollowing({ titleFontSize: currentSlide.titleFontSize })}
                                                />
                                            </div>
                                            
                                            <div>
                                                <FontSizeSlider
                                                    label="–†–∞–∑–º–µ—Ä –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞"
                                                    value={currentSlide.mainFontSize || 75}
                                                    onChange={(value) => {
                                                        updateCurrentSlide('mainFontSize', value);
                                                        markSettingChanged('mainFontSize');
                                                    }}
                                                    min={16}
                                                    max={150}
                                                />
                                                <ApplyButtons
                                                    settingKey="mainFontSize"
                                                    settingName="—Ä–∞–∑–º–µ—Ä –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞"
                                                    onApplyCurrent={() => {}}
                                                    onApplyAll={() => applyToCurrentAndFollowing({ mainFontSize: currentSlide.mainFontSize })}
                                                />
                                            </div>
                                            
                                            <div>
                                                <FontSizeSlider
                                                    label="–†–∞–∑–º–µ—Ä –∞–∫—Ü–µ–Ω—Ç–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞"
                                                    value={currentSlide.accentFontSize || 70}
                                                    onChange={(value) => {
                                                        updateCurrentSlide('accentFontSize', value);
                                                        markSettingChanged('accentFontSize');
                                                    }}
                                                    min={24}
                                                    max={150}
                                                />
                                                <ApplyButtons
                                                    settingKey="accentFontSize"
                                                    settingName="—Ä–∞–∑–º–µ—Ä –∞–∫—Ü–µ–Ω—Ç–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞"
                                                    onApplyCurrent={() => {}}
                                                    onApplyAll={() => applyToCurrentAndFollowing({ accentFontSize: currentSlide.accentFontSize })}
                                                />
                                            </div>
                                        </div>
                                    </div>

                                    <div className="bg-gray-50 rounded-lg border border-gray-200">
                                        <button
                                            onClick={() => setIsStyleSectionOpen(!isStyleSectionOpen)}
                                            className="w-full p-4 flex items-center justify-between hover:bg-gray-100 transition-colors rounded-lg"
                                        >
                                            <h3 className="font-semibold text-gray-700 flex items-center gap-2">
                                                üé® –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ
                                            </h3>
                                            <span className="text-2xl">{isStyleSectionOpen ? '‚ñ≤' : '‚ñº'}</span>
                                        </button>
                                        
                                        {isStyleSectionOpen && (
                                            <div className="p-4 pt-0">
                                                <div className="space-y-3">
                                                    <div>
                                                        <label className="block text-sm font-medium text-gray-600 mb-1">
                                                            –¢–∏–ø —Ñ–æ–Ω–∞
                                                        </label>
                                                        <select
                                                            value={currentSlide.bgType || 'solid'}
                                                            onChange={(e) => {
                                                                updateCurrentSlide('bgType', e.target.value);
                                                            }}
                                                            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"
                                                        >
                                                            <option value="solid">–û–¥–Ω–æ—Ç–æ–Ω–Ω—ã–π</option>
                                                            <option value="gradient">–ì—Ä–∞–¥–∏–µ–Ω—Ç</option>
                                                            <option value="image">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</option>
                                                        </select>
                                                    </div>
                                                    
                                                    {(currentSlide.bgType || 'solid') === 'image' ? (
                                                        <div>
                                                            <label className="block text-sm font-medium text-gray-600 mb-2">
                                                                –§–æ–Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                                                            </label>
                                                            {currentSlide.bgImage ? (
                                                                <div className="space-y-3">
                                                                    <div className="relative w-full h-32 rounded-lg overflow-hidden border-2 border-gray-300">
                                                                        <img 
                                                                            src={currentSlide.bgImage} 
                                                                            alt="–§–æ–Ω" 
                                                                            className="w-full h-full object-cover"
                                                                        />
                                                                    </div>
                                                                    <button
                                                                        onClick={() => setShowDeleteModal(true)}
                                                                        className="w-full px-4 py-3 bg-gradient-to-r from-red-50 to-orange-50 text-red-700 rounded-lg hover:from-red-100 hover:to-orange-100 transition-all font-semibold border-2 border-red-300 flex items-center justify-center gap-2"
                                                                    >
                                                                        üîÑ –ò–∑–º–µ–Ω–∏—Ç—å —Ñ–æ–Ω
                                                                    </button>
                                                                </div>
                                                            ) : (
                                                                <>
                                                                    <input
                                                                        ref={fileInputRef}
                                                                        type="file"
                                                                        accept="image/*"
                                                                        onChange={handleImageSelect}
                                                                        className="hidden"
                                                                    />
                                                                    <button
                                                                        onClick={() => fileInputRef.current?.click()}
                                                                        className="w-full px-4 py-8 border-2 border-dashed border-blue-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-colors text-center font-semibold text-blue-600 flex flex-col items-center justify-center gap-2"
                                                                    >
                                                                        <span className="text-4xl">üìÅ</span>
                                                                        <span>–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</span>
                                                                    </button>
                                                                </>
                                                            )}
                                                        </div>
                                                    ) : (
                                                        <div className="space-y-3">
                                                            <div>
                                                                <label className="block text-sm font-medium text-gray-600 mb-2">
                                                                    {(currentSlide.bgType || 'solid') === 'solid' ? '–¶–≤–µ—Ç —Ñ–æ–Ω–∞' : '–¶–≤–µ—Ç —Ñ–æ–Ω–∞ 1'}
                                                                </label>
                                                                <div className="flex gap-2">
                                                                    <input
                                                                        type="color"
                                                                        value={currentSlide.bgColor1 || '#1e40af'}
                                                                        onChange={(e) => {
                                                                            updateCurrentSlide('bgColor1', e.target.value);
                                                                            markSettingChanged('bgColor1');
                                                                        }}
                                                                        className="h-10 w-20 rounded border border-gray-300 cursor-pointer"
                                                                    />
                                                                    <input
                                                                        type="text"
                                                                        value={currentSlide.bgColor1 || '#1e40af'}
                                                                        onChange={(e) => {
                                                                            updateCurrentSlide('bgColor1', e.target.value);
                                                                            markSettingChanged('bgColor1');
                                                                        }}
                                                                        className="flex-1 px-2 py-1 border border-gray-300 rounded text-sm"
                                                                    />
                                                                </div>
                                                                <ApplyButtons
                                                                    settingKey="bgColor1"
                                                                    settingName="—Ü–≤–µ—Ç —Ñ–æ–Ω–∞"
                                                                    onApplyCurrent={() => {}}
                                                                    onApplyAll={() => applyToCurrentAndFollowing({ bgColor1: currentSlide.bgColor1 })}
                                                                />
                                                            </div>
                                                            
                                                            {(currentSlide.bgType || 'solid') === 'gradient' && (
                                                                <div>
                                                                    <label className="block text-sm font-medium text-gray-600 mb-2">
                                                                        –¶–≤–µ—Ç —Ñ–æ–Ω–∞ 2
                                                                    </label>
                                                                    <div className="flex gap-2">
                                                                        <input
                                                                            type="color"
                                                                            value={currentSlide.bgColor2 || '#7c3aed'}
                                                                            onChange={(e) => {
                                                                                updateCurrentSlide('bgColor2', e.target.value);
                                                                                markSettingChanged('bgColor2');
                                                                            }}
                                                                            className="h-10 w-20 rounded border border-gray-300 cursor-pointer"
                                                                        />
                                                                        <input
                                                                            type="text"
                                                                            value={currentSlide.bgColor2 || '#7c3aed'}
                                                                            onChange={(e) => {
                                                                                updateCurrentSlide('bgColor2', e.target.value);
                                                                                markSettingChanged('bgColor2');
                                                                            }}
                                                                            className="flex-1 px-2 py-1 border border-gray-300 rounded text-sm"
                                                                        />
                                                                    </div>
                                                                    <ApplyButtons
                                                                        settingKey="bgColor2"
                                                                        settingName="–≤—Ç–æ—Ä–æ–π —Ü–≤–µ—Ç —Ñ–æ–Ω–∞"
                                                                        onApplyCurrent={() => {}}
                                                                        onApplyAll={() => applyToCurrentAndFollowing({ bgColor2: currentSlide.bgColor2 })}
                                                                    />
                                                                </div>
                                                            )}
                                                        </div>
                                                    )}
                                                    
                                                    <div>
                                                        <label className="block text-sm font-medium text-gray-600 mb-2">
                                                            –¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞
                                                        </label>
                                                        <div className="flex gap-2">
                                                            <input
                                                                type="color"
                                                                value={currentSlide.textColor || '#ffffff'}
                                                                onChange={(e) => {
                                                                    updateCurrentSlide('textColor', e.target.value);
                                                                    markSettingChanged('textColor');
                                                                }}
                                                                className="h-10 w-20 rounded border border-gray-300 cursor-pointer"
                                                            />
                                                            <input
                                                                type="text"
                                                                value={currentSlide.textColor || '#ffffff'}
                                                                onChange={(e) => {
                                                                    updateCurrentSlide('textColor', e.target.value);
                                                                    markSettingChanged('textColor');
                                                                }}
                                                                className="flex-1 px-2 py-1 border border-gray-300 rounded text-sm"
                                                            />
                                                        </div>
                                                        <ApplyButtons
                                                            settingKey="textColor"
                                                            settingName="—Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞"
                                                            onApplyCurrent={() => {}}
                                                            onApplyAll={() => applyToCurrentAndFollowing({ textColor: currentSlide.textColor })}
                                                        />
                                                    </div>
                                                    
                                                    <div className="space-y-3 mt-4 pt-4 border-t border-gray-200">
                                                        <div>
                                                            <label className="block text-sm font-medium text-gray-600 mb-2">
                                                                –¶–≤–µ—Ç –∞–∫—Ü–µ–Ω—Ç–Ω–æ–π –ø–æ–¥–ª–æ–∂–∫–∏
                                                            </label>
                                                            <div className="flex gap-2">
                                                                <input
                                                                    type="color"
                                                                    value={currentSlide.accentBgColor || '#fbbf24'}
                                                                    onChange={(e) => {
                                                                        updateCurrentSlide('accentBgColor', e.target.value);
                                                                        markSettingChanged('accentBgColor');
                                                                    }}
                                                                    className="h-10 w-20 rounded border border-gray-300 cursor-pointer"
                                                                />
                                                                <input
                                                                    type="text"
                                                                    value={currentSlide.accentBgColor || '#fbbf24'}
                                                                    onChange={(e) => {
                                                                        updateCurrentSlide('accentBgColor', e.target.value);
                                                                        markSettingChanged('accentBgColor');
                                                                    }}
                                                                    className="flex-1 px-2 py-1 border border-gray-300 rounded text-sm"
                                                                />
                                                            </div>
                                                            <ApplyButtons
                                                                settingKey="accentBgColor"
                                                                settingName="—Ü–≤–µ—Ç –∞–∫—Ü–µ–Ω—Ç–Ω–æ–π –ø–æ–¥–ª–æ–∂–∫–∏"
                                                                onApplyCurrent={() => {}}
                                                                onApplyAll={() => applyToCurrentAndFollowing({ accentBgColor: currentSlide.accentBgColor })}
                                                            />
                                                        </div>
                                                        
                                                        <div>
                                                            <label className="block text-sm font-medium text-gray-600 mb-2">
                                                                –¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –Ω–∞ –∞–∫—Ü–µ–Ω—Ç–µ
                                                            </label>
                                                            <div className="flex gap-2">
                                                                <input
                                                                    type="color"
                                                                    value={currentSlide.accentTextColor || '#000000'}
                                                                    onChange={(e) => {
                                                                        updateCurrentSlide('accentTextColor', e.target.value);
                                                                        markSettingChanged('accentTextColor');
                                                                    }}
                                                                    className="h-10 w-20 rounded border border-gray-300 cursor-pointer"
                                                                />
                                                                <input
                                                                    type="text"
                                                                    value={currentSlide.accentTextColor || '#000000'}
                                                                    onChange={(e) => {
                                                                        updateCurrentSlide('accentTextColor', e.target.value);
                                                                        markSettingChanged('accentTextColor');
                                                                    }}
                                                                    className="flex-1 px-2 py-1 border border-gray-300 rounded text-sm"
                                                                />
                                                            </div>
                                                            <ApplyButtons
                                                                settingKey="accentTextColor"
                                                                settingName="—Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –Ω–∞ –∞–∫—Ü–µ–Ω—Ç–µ"
                                                                onApplyCurrent={() => {}}
                                                                onApplyAll={() => applyToCurrentAndFollowing({ accentTextColor: currentSlide.accentTextColor })}
                                                            />
                                                        </div>
                                                    </div>
                                                    
                                                    <div>
                                                        <label className="block text-sm font-medium text-gray-600 mb-1">
                                                            –®—Ä–∏—Ñ—Ç
                                                        </label>
                                                        <select
                                                            value={currentSlide.fontFamily || 'Inter'}
                                                            onChange={(e) => {
                                                                updateCurrentSlide('fontFamily', e.target.value);
                                                                markSettingChanged('fontFamily');
                                                            }}
                                                            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"
                                                        >
                                                            {fonts.map(font => (
                                                                <option key={font.name} value={font.name}>
                                                                    {font.name}
                                                                </option>
                                                            ))}
                                                        </select>
                                                        <ApplyButtons
                                                            settingKey="fontFamily"
                                                            settingName="—à—Ä–∏—Ñ—Ç"
                                                            onApplyCurrent={() => {}}
                                                            onApplyAll={() => applyToCurrentAndFollowing({ fontFamily: currentSlide.fontFamily })}
                                                        />
                                                    </div>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                    
                                    <div className="space-y-2">
                                        <button
                                            onClick={exportCurrentSlide}
                                            className="w-full bg-blue-600 text-white py-3 px-4 rounded-md hover:bg-blue-700 transition-colors flex items-center justify-center gap-2 font-medium shadow-md hover:shadow-lg"
                                        >
                                            ‚¨áÔ∏è –°–∫–∞—á–∞—Ç—å —Ç–µ–∫—É—â–∏–π —Å–ª–∞–π–¥
                                        </button>
                                        
                                        <button
                                            onClick={exportAllSlidesAsZip}
                                            disabled={isExporting}
                                            className="w-full bg-green-600 text-white py-3 px-4 rounded-md hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2 font-medium shadow-md hover:shadow-lg"
                                        >
                                            üì¶ –°–∫–∞—á–∞—Ç—å –≤—Å–µ —Å–ª–∞–π–¥—ã ZIP ({slides.length})
                                        </button>
                                        
                                        <button
                                            onClick={exportAllSlidesAsPDF}
                                            disabled={isExporting}
                                            className="w-full bg-purple-600 text-white py-3 px-4 rounded-md hover:bg-purple-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2 font-medium shadow-md hover:shadow-lg"
                                        >
                                            üìÑ –°–∫–∞—á–∞—Ç—å –≤—Å–µ —Å–ª–∞–π–¥—ã PDF ({slides.length})
                                        </button>
                                    </div>
                                </div>
                                
                                <div>
                                    <div className="sticky top-4">
                                        <label className="block text-sm font-medium text-gray-600 mb-2">
                                            –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Å–ª–∞–π–¥–∞ {currentSlideIndex + 1}
                                        </label>
                                        <div className="bg-gray-200 p-4 rounded-lg">
                                            <div
                                                ref={slideRef}
                                                className={`${getAspectRatioClass()} rounded-lg shadow-xl overflow-hidden`}
                                                style={getSlideBackground()}
                                            >
                                                <div className="h-full flex flex-col justify-center p-12">
                                                    {currentSlide.title && (
                                                        <h2
                                                            className={`font-bold mb-6 ${
                                                                currentSlide.titleAlign === 'left' ? 'self-start text-left' : 'self-center text-center'
                                                            }`}
                                                            style={{
                                                                fontFamily: fonts.find(f => f.name === (currentSlide.fontFamily || 'Inter'))?.value,
                                                                color: currentSlide.textColor || '#ffffff',
                                                                fontSize: `${(currentSlide.titleFontSize || 130) * 0.25}px`,
                                                                whiteSpace: 'pre-wrap'
                                                            }}
                                                        >
                                                            {currentSlide.title}
                                                        </h2>
                                                    )}
                                                    
                                                    {currentSlide.mainText && (
                                                        <p
                                                            className={`mb-6 max-w-2xl ${
                                                                currentSlide.mainTextAlign === 'left' ? 'self-start text-left' : 'self-center text-center'
                                                            }`}
                                                            style={{
                                                                fontFamily: fonts.find(f => f.name === (currentSlide.fontFamily || 'Inter'))?.value,
                                                                color: currentSlide.textColor || '#ffffff',
                                                                opacity: 0.9,
                                                                fontSize: `${(currentSlide.mainFontSize || 75) * 0.25}px`,
                                                                whiteSpace: 'pre-wrap'
                                                            }}
                                                        >
                                                            {currentSlide.mainText}
                                                        </p>
                                                    )}
                                                    
                                                    {currentSlide.accentText && (
                                                        <div className={`mb-6 ${
                                                            currentSlide.accentAlign === 'left' ? 'self-start' : 'self-center'
                                                        }`}>
                                                            <div className="relative inline-block">
                                                                <div
                                                                    className="absolute inset-0 rounded-lg"
                                                                    style={{
                                                                        backgroundColor: currentSlide.accentBgColor || '#fbbf24',
                                                                        margin: `-${(currentSlide.accentFontSize || 70) * 0.15}px -${(currentSlide.accentFontSize || 70) * 0.3}px`
                                                                    }}
                                                                />
                                                                <p
                                                                    className="relative font-semibold"
                                                                    style={{
                                                                        fontFamily: fonts.find(f => f.name === (currentSlide.fontFamily || 'Inter'))?.value,
                                                                        color: currentSlide.accentTextColor || '#000000',
                                                                        fontSize: `${(currentSlide.accentFontSize || 70) * 0.25}px`,
                                                                        padding: `${(currentSlide.accentFontSize || 70) * 0.15}px ${(currentSlide.accentFontSize || 70) * 0.3}px`,
                                                                        whiteSpace: 'pre-wrap'
                                                                    }}
                                                                >
                                                                    {currentSlide.accentText}
                                                                </p>
                                                            </div>
                                                        </div>
                                                    )}
                                                    
                                                    {currentSlide.secondaryText && (
                                                        <p
                                                            className={`max-w-2xl ${
                                                                currentSlide.secondaryTextAlign === 'left' ? 'self-start text-left' : 'self-center text-center'
                                                            }`}
                                                            style={{
                                                                fontFamily: fonts.find(f => f.name === (currentSlide.fontFamily || 'Inter'))?.value,
                                                                color: currentSlide.textColor || '#ffffff',
                                                                opacity: 0.9,
                                                                fontSize: `${(currentSlide.mainFontSize || 75) * 0.25}px`,
                                                                whiteSpace: 'pre-wrap'
                                                            }}
                                                        >
                                                            {currentSlide.secondaryText}
                                                        </p>
                                                    )}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<PresentationDesigner />, document.getElementById('root'));
    </script>
</body>
</html>
