  <!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–∏–∑–∞–π–Ω–µ—Ä –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Roboto:wght@400;700&family=Playfair+Display:wght@400;700&family=Montserrat:wght@400;700&family=Open+Sans:wght@400;700&display=swap" rel="stylesheet">
    <style>
        @keyframes fadeInOut {
            0% { opacity: 0; transform: scale(0.8); }
            10% { opacity: 1; transform: scale(1); }
            90% { opacity: 1; transform: scale(1); }
            100% { opacity: 0; transform: scale(0.8); }
        }
        .animate-fade-in-out {
            animation: fadeInOut 1s ease-in-out;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- html2canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <!-- JSZip -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    
    <!-- jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        // –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å localStorage –∏ –ø—Ä–æ–µ–∫—Ç–∞–º–∏
        const ProjectUtils = {
            FORBIDDEN_CHARS: /[\/\\:*?"<>|]/g,
            FORBIDDEN_CHARS_LIST: '/ \\ : * ? " < > |',
            
            // –ü–æ–ª—É—á–∏—Ç—å –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –≤–∫–ª–∞–¥–∫–∏
            getTabId: () => {
                let tabId = sessionStorage.getItem('presentation_tab_id');
                if (!tabId) {
                    tabId = Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                    sessionStorage.setItem('presentation_tab_id', tabId);
                }
                return tabId;
            },
            
            // –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞–∑–≤–∞–Ω–∏—è –¥–ª—è –∫–ª—é—á–∞ (–∑–∞–º–µ–Ω–∞ –ø—Ä–æ–±–µ–ª–æ–≤ –Ω–∞ –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–Ω–∏—è)
            normalizeForKey: (name) => {
                return name.replace(/\s+/g, '_').replace(ProjectUtils.FORBIDDEN_CHARS, '_');
            },
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã
            hasInvalidChars: (name) => {
                return ProjectUtils.FORBIDDEN_CHARS.test(name);
            },
            
            // –ü–æ–ª—É—á–∏—Ç—å –∫–ª—é—á –ø—Ä–æ–µ–∫—Ç–∞
            getProjectKey: (projectName) => {
                return `presentation_${ProjectUtils.normalizeForKey(projectName)}`;
            },
            
            // –ü–æ–ª—É—á–∏—Ç—å –∫–ª—é—á —Å–µ—Å—Å–∏–∏
            getSessionKey: (projectName) => {
                return `presentation_session_${ProjectUtils.normalizeForKey(projectName)}`;
            },
            
            // –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –ø—Ä–æ–µ–∫—Ç—ã
            getAllProjects: () => {
                const projects = [];
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && key.startsWith('presentation_') && !key.includes('_session_')) {
                        try {
                            const data = JSON.parse(localStorage.getItem(key));
                            if (data && data.projectName) {
                                projects.push({
                                    name: data.projectName,
                                    lastModified: data.lastModified || Date.now(),
                                    slideCount: data.slides ? data.slides.length : 0
                                });
                            }
                        } catch (e) {
                            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞:', key, e);
                        }
                    }
                }
                // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ (—Å–≤–µ–∂–∏–µ —Å–≤–µ—Ä—Ö—É)
                return projects.sort((a, b) => b.lastModified - a.lastModified);
            },
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ (–±–µ–∑ —É—á–µ—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞)
            projectExists: (projectName) => {
                const normalized = projectName.toLowerCase().trim();
                const projects = ProjectUtils.getAllProjects();
                return projects.some(p => p.name.toLowerCase().trim() === normalized);
            },
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
            loadProject: (projectName) => {
                const key = ProjectUtils.getProjectKey(projectName);
                try {
                    const data = localStorage.getItem(key);
                    return data ? JSON.parse(data) : null;
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–æ–µ–∫—Ç–∞:', e);
                    return null;
                }
            },
            
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ (–±–µ–∑ —Ñ–æ–Ω–æ–≤—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)
            saveProject: (projectName, data) => {
                const key = ProjectUtils.getProjectKey(projectName);
                
                // –£–±–∏—Ä–∞–µ–º —Ñ–æ–Ω–æ–≤—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º
                const dataToSave = {
                    ...data,
                    slides: data.slides.map(slide => ({
                        ...slide,
                        bgImage: null  // –ù–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                    })),
                    lastModified: Date.now()
                };
                
                try {
                    const jsonString = JSON.stringify(dataToSave);
                    localStorage.setItem(key, jsonString);
                    return true;
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞:', e);
                    return false;
                }
            },
            
            // –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
            deleteProject: (projectName) => {
                const key = ProjectUtils.getProjectKey(projectName);
                const sessionKey = ProjectUtils.getSessionKey(projectName);
                try {
                    localStorage.removeItem(key);
                    localStorage.removeItem(sessionKey);
                    return true;
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞:', e);
                    return false;
                }
            },
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞
            checkStorageSpace: () => {
                try {
                    const testKey = '_storage_test_';
                    const testData = new Array(1024).join('a'); // ~1KB
                    let available = 0;
                    
                    // –ü—Ä–æ–±—É–µ–º –∑–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
                    for (let i = 0; i < 10000; i++) {
                        try {
                            localStorage.setItem(testKey + i, testData);
                            available += testData.length;
                        } catch (e) {
                            // –ú–µ—Å—Ç–æ –∑–∞–∫–æ–Ω—á–∏–ª–æ—Å—å
                            break;
                        }
                    }
                    
                    // –û—á–∏—â–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
                    for (let i = 0; i < 10000; i++) {
                        localStorage.removeItem(testKey + i);
                    }
                    
                    return available;
                } catch (e) {
                    return 0;
                }
            },
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –Ω–∏–∑–∫–æ–µ –º–µ—Å—Ç–æ
            isStorageLow: (lastSaveSize = 150000) => {
                const available = ProjectUtils.checkStorageSpace();
                const threshold = Math.max(lastSaveSize * 1.2, 200000); // 20% –∑–∞–ø–∞—Å –∏–ª–∏ –º–∏–Ω–∏–º—É–º 200KB
                return available < threshold;
            },
            
            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Å–µ—Å—Å–∏–∏ —Å tabId
            setSessionLock: (projectName) => {
                const sessionKey = ProjectUtils.getSessionKey(projectName);
                const tabId = ProjectUtils.getTabId();
                const sessionData = {
                    tabId: tabId,
                    timestamp: Date.now()
                };
                localStorage.setItem(sessionKey, JSON.stringify(sessionData));
                return tabId;
            },
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Å–µ—Å—Å–∏–∏ —Å —É—á—ë—Ç–æ–º tabId
            checkSessionLock: (projectName, currentTabId) => {
                const sessionKey = ProjectUtils.getSessionKey(projectName);
                const storedData = localStorage.getItem(sessionKey);
                
                if (!storedData) {
                    return false; // –ù–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
                }
                
                try {
                    const sessionData = JSON.parse(storedData);
                    // –ï—Å–ª–∏ tabId —Å–æ–≤–ø–∞–¥–∞–µ—Ç - —ç—Ç–æ —Ç–∞ –∂–µ –≤–∫–ª–∞–¥–∫–∞ (–¥–∞–∂–µ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏)
                    return sessionData.tabId !== currentTabId;
                } catch (e) {
                    // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å, —Å—á–∏—Ç–∞–µ–º —á—Ç–æ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –µ—Å—Ç—å
                    return true;
                }
            },
            
            // –°–Ω—è—Ç–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Å–µ—Å—Å–∏–∏
            releaseSessionLock: (projectName) => {
                const sessionKey = ProjectUtils.getSessionKey(projectName);
                localStorage.removeItem(sessionKey);
            },
            
            // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã –ø–æ –º–æ—Å–∫–æ–≤—Å–∫–æ–º—É –≤—Ä–µ–º–µ–Ω–∏
            formatDate: (timestamp) => {
                const date = new Date(timestamp);
                // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ –º–æ—Å–∫–æ–≤—Å–∫–æ–µ –≤—Ä–µ–º—è (UTC+3)
                const moscowOffset = 3 * 60; // –º–∏–Ω—É—Ç—ã
                const localOffset = date.getTimezoneOffset(); // –º–∏–Ω—É—Ç—ã
                const moscowTime = new Date(date.getTime() + (moscowOffset + localOffset) * 60000);
                
                const day = String(moscowTime.getDate()).padStart(2, '0');
                const month = String(moscowTime.getMonth() + 1).padStart(2, '0');
                const year = moscowTime.getFullYear();
                const hours = String(moscowTime.getHours()).padStart(2, '0');
                const minutes = String(moscowTime.getMinutes()).padStart(2, '0');
                
                return `${day}.${month}.${year}, ${hours}:${minutes}`;
            }
        };

        const PresentationDesigner = () => {
            const [mode, setMode] = useState('projectSelect'); // projectSelect, import, edit
            const [projectName, setProjectName] = useState('');
            const [sessionId, setSessionId] = useState(null);
            const [slides, setSlides] = useState([]);
            const [currentSlideIndex, setCurrentSlideIndex] = useState(0);
            const [changedSettings, setChangedSettings] = useState({});
            const [isStyleSectionOpen, setIsStyleSectionOpen] = useState(false);
            const [aspectRatio, setAspectRatio] = useState('16:9');
            const [showImageModal, setShowImageModal] = useState(false);
            const [showDeleteModal, setShowDeleteModal] = useState(false);
            const [pendingImage, setPendingImage] = useState(null);
            const [isExporting, setIsExporting] = useState(false);
            const [exportProgress, setExportProgress] = useState(0);
            
            // –ù–æ–≤—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞–º–∏
            const [allProjects, setAllProjects] = useState([]);
            const [showAllProjects, setShowAllProjects] = useState(false);
            const [showNewProjectModal, setShowNewProjectModal] = useState(false);
            const [newProjectName, setNewProjectName] = useState('');
            const [newProjectError, setNewProjectError] = useState('');
            const [showConfirmCreate, setShowConfirmCreate] = useState(false);
            const [showConfirmDelete, setShowConfirmDelete] = useState(false);
            const [projectToDelete, setProjectToDelete] = useState('');
            const [showStorageWarning, setShowStorageWarning] = useState(false);
            const [showSessionWarning, setShowSessionWarning] = useState(false);
            const [lastSaveTime, setLastSaveTime] = useState(null);
            const [isSaving, setIsSaving] = useState(false);
            const [showConfirmDeleteSlide, setShowConfirmDeleteSlide] = useState(false);
            const [slideToDelete, setSlideToDelete] = useState(null);
            const [showInstructions, setShowInstructions] = useState(false);
            
            const slideRef = useRef(null);
            const importTextRef = useRef(null);
            const fileInputRef = useRef(null);
            const importProjectFileRef = useRef(null);
            const autoSaveIntervalRef = useRef(null);
            
            // –†–µ—Ñ—ã –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞
            const mainTextRef = useRef(null);
            const accentTextRef = useRef(null);
            const secondaryTextRef = useRef(null);

            // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤ –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
            useEffect(() => {
                loadProjectsList();
            }, []);

            // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
            useEffect(() => {
                if (mode === 'edit' && slides.length > 0 && projectName) {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–ª–æ–∫–∏—Ä–æ–≤–∫—É —Å–µ—Å—Å–∏–∏ –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º
                    if (sessionId && ProjectUtils.checkSessionLock(projectName, sessionId)) {
                        setShowSessionWarning(true);
                        return;
                    }
                    
                    autoSaveIntervalRef.current = setInterval(() => {
                        autoSaveProject();
                    }, 30000); // 30 —Å–µ–∫—É–Ω–¥

                    return () => {
                        if (autoSaveIntervalRef.current) {
                            clearInterval(autoSaveIntervalRef.current);
                        }
                    };
                }
            }, [mode, slides, projectName, aspectRatio, currentSlideIndex, sessionId]);

            // –û—Ç–∫—Ä—ã—Ç–∏–µ —Å–µ–∫—Ü–∏–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –Ω–∞ –ø–µ—Ä–≤–æ–º —Å–ª–∞–π–¥–µ
            useEffect(() => {
                if (mode === 'edit') {
                    setIsStyleSectionOpen(currentSlideIndex === 0);
                }
            }, [mode, currentSlideIndex]);

            // –°–Ω—è—Ç–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            useEffect(() => {
                const handleBeforeUnload = () => {
                    if (projectName && sessionId) {
                        ProjectUtils.releaseSessionLock(projectName);
                    }
                };
                
                window.addEventListener('beforeunload', handleBeforeUnload);
                return () => {
                    window.removeEventListener('beforeunload', handleBeforeUnload);
                    if (projectName && sessionId) {
                        ProjectUtils.releaseSessionLock(projectName);
                    }
                };
            }, [projectName, sessionId]);

            const fonts = [
                { name: 'Inter', value: 'Inter, sans-serif' },
                { name: 'Roboto', value: 'Roboto, sans-serif' },
                { name: 'Playfair Display', value: 'Playfair Display, serif' },
                { name: 'Montserrat', value: 'Montserrat, sans-serif' },
                { name: 'Open Sans', value: 'Open Sans, sans-serif' }
            ];

            const loadProjectsList = () => {
                const projects = ProjectUtils.getAllProjects();
                setAllProjects(projects);
            };

            const autoSaveProject = () => {
                if (!projectName || slides.length === 0) return;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ
                if (ProjectUtils.isStorageLow()) {
                    setShowStorageWarning(true);
                    return;
                }
                
                setIsSaving(true);
                
                const projectData = {
                    projectName,
                    aspectRatio,
                    currentSlideIndex,
                    slides
                };
                
                const success = ProjectUtils.saveProject(projectName, projectData);
                
                if (success) {
                    setLastSaveTime(Date.now());
                }
                
                // –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
                setTimeout(() => setIsSaving(false), 1000);
            };

            const handleCreateNewProject = () => {
                setNewProjectName('');
                setNewProjectError('');
                setShowNewProjectModal(true);
            };

            const handleNewProjectNameChange = (value) => {
                setNewProjectName(value);
                
                if (value.trim() === '') {
                    setNewProjectError('');
                    return;
                }
                
                if (ProjectUtils.hasInvalidChars(value)) {
                    setNewProjectError(`–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–µ –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Å–∏–º–≤–æ–ª—ã: ${ProjectUtils.FORBIDDEN_CHARS_LIST}`);
                    return;
                }
                
                if (ProjectUtils.projectExists(value)) {
                    setNewProjectError('–ü—Ä–æ–µ–∫—Ç —Å —Ç–∞–∫–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –í—ã–±–µ—Ä–∏—Ç–µ –¥—Ä—É–≥–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ.');
                    return;
                }
                
                setNewProjectError('');
            };

            const handleConfirmNewProject = () => {
                if (newProjectName.trim() === '') {
                    setNewProjectError('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞');
                    return;
                }
                
                if (newProjectError) return;
                
                setShowNewProjectModal(false);
                setShowConfirmCreate(true);
            };

            const handleFinalCreateProject = () => {
                setProjectName(newProjectName.trim());
                const tabId = ProjectUtils.setSessionLock(newProjectName.trim());
                setSessionId(tabId);
                setShowConfirmCreate(false);
                setMode('import');
            };

            const handleContinueProject = (name) => {
                // –ü–æ–ª—É—á–∞–µ–º tabId —Ç–µ–∫—É—â–µ–π –≤–∫–ª–∞–¥–∫–∏
                const currentTabId = ProjectUtils.getTabId();
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–ª–æ–∫–∏—Ä–æ–≤–∫—É —Å–µ—Å—Å–∏–∏
                if (ProjectUtils.checkSessionLock(name, currentTabId)) {
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–º—è –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
                    setProjectName(name);
                    setShowSessionWarning(true);
                    return;
                }
                
                const projectData = ProjectUtils.loadProject(name);
                if (projectData) {
                    setProjectName(name);
                    const tabId = ProjectUtils.setSessionLock(name);
                    setSessionId(tabId);
                    setAspectRatio(projectData.aspectRatio || '16:9');
                    setCurrentSlideIndex(projectData.currentSlideIndex || 0);
                    
                    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–ª–∞–π–¥—ã, –ø–æ–º–µ—á–∞—è –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ñ–æ–Ω–æ–≤—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
                    const restoredSlides = projectData.slides.map(slide => ({
                        ...slide,
                        bgImage: null,
                        bgType: slide.bgType === 'image' ? 'solid' : slide.bgType
                    }));
                    
                    setSlides(restoredSlides);
                    setMode('edit');
                }
            };

            const handleDeleteProject = (name) => {
                setProjectToDelete(name);
                setShowConfirmDelete(true);
            };

            const handleConfirmDeleteProject = () => {
                if (projectToDelete) {
                    ProjectUtils.deleteProject(projectToDelete);
                    loadProjectsList();
                    setShowConfirmDelete(false);
                    setProjectToDelete('');
                }
            };

            const handleExportProjectFromList = (projectNameToExport) => {
                const projectData = ProjectUtils.loadProject(projectNameToExport);
                if (!projectData) {
                    alert('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ–µ–∫—Ç –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞.');
                    return;
                }
                
                const jsonString = JSON.stringify(projectData, null, 2);
                const blob = new Blob([jsonString], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                const safeProjectName = getSafeFileName(projectNameToExport);
                link.download = `${safeProjectName}_backup.json`;
                link.href = url;
                link.click();
                URL.revokeObjectURL(url);
            };

            const handleBackToProjects = () => {
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–µ—Ä–µ–¥ –≤—ã—Ö–æ–¥–æ–º
                if (slides.length > 0) {
                    autoSaveProject();
                }
                
                // –°–Ω–∏–º–∞–µ–º –±–ª–æ–∫–∏—Ä–æ–≤–∫—É
                if (projectName && sessionId) {
                    ProjectUtils.releaseSessionLock(projectName);
                }
                
                setMode('projectSelect');
                setProjectName('');
                setSessionId(null);
                setSlides([]);
                setCurrentSlideIndex(0);
                loadProjectsList();
            };

            const markSettingChanged = (settingName) => {
                setChangedSettings(prev => ({
                    ...prev,
                    [settingName]: true
                }));
            };

            const clearSettingChange = (settingName) => {
                setChangedSettings(prev => {
                    const newState = { ...prev };
                    delete newState[settingName];
                    return newState;
                });
            };

            const applyToCurrentSlide = (settings) => {
                const updatedSlides = [...slides];
                updatedSlides[currentSlideIndex] = {
                    ...updatedSlides[currentSlideIndex],
                    ...settings
                };
                setSlides(updatedSlides);
            };

            const applyToCurrentAndFollowing = (settings) => {
                const updatedSlides = slides.map((slide, index) => {
                    if (index >= currentSlideIndex) {
                        return { ...slide, ...settings };
                    }
                    return slide;
                });
                setSlides(updatedSlides);
            };

            const applyToAllSlides = (settings) => {
                const updatedSlides = slides.map(slide => ({
                    ...slide,
                    ...settings
                }));
                setSlides(updatedSlides);
            };

           // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// –£–õ–£–ß–®–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –ü–ê–†–°–ò–ù–ì–ê –°–õ–ê–ô–î–û–í (–ù–û–í–´–ï –ü–†–ê–í–ò–õ–ê)
// 
// –ù–û–í–´–ï –ü–†–ê–í–ò–õ–ê:
// 1. –ó–∞–≥–æ–ª–æ–≤–æ–∫: ‚â§6 —Å–ª–æ–≤ = TITLE, ‚â•7 —Å–ª–æ–≤ = —Å—Ä–∞–∑—É MAIN TEXT
// 2. –ê–∫—Ü–µ–Ω—Ç–Ω—ã–π —Ç–µ–∫—Å—Ç: –≤—Å–µ–≥–¥–∞ –ø—É—Å—Ç–æ–π
// 3. –°—Ç—Ä–æ–∫–∏ —Å ":" ‚Üí **–∂–∏—Ä–Ω—ã–µ** + —Å–ø–∏—Å–æ–∫ –ø–æ—Å–ª–µ –Ω–∏—Ö
// 4. –°–ø–∏—Å–æ–∫ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è –¥–æ –ø—É—Å—Ç–æ–π —Å—Ç—Ä–æ–∫–∏
// 5. –ü–æ—Å–ª–µ –ø—É—Å—Ç–æ–π —Å—Ç—Ä–æ–∫–∏ ‚Üí SECONDARY TEXT
// 
// –ò–ù–°–¢–†–£–ö–¶–ò–Ø –ü–û –£–°–¢–ê–ù–û–í–ö–ï:
// 1. –ù–∞–π–¥–∏ –≤ —Å–≤–æ—ë–º —Ñ–∞–π–ª–µ —Å—Ç—Ä–æ–∫—É 556 (–Ω–∞—á–∞–ª–æ —Ñ—É–Ω–∫—Ü–∏–∏ parseSlides)
// 2. –£–¥–∞–ª–∏ —Å—Ç—Ä–æ–∫–∏ —Å 556 –ø–æ 663 (–≤—Å—é —Å—Ç–∞—Ä—É—é —Ñ—É–Ω–∫—Ü–∏—é parseSlides)
// 3. –í—Å—Ç–∞–≤—å —ç—Ç–æ—Ç –∫–æ–¥ –≤–º–µ—Å—Ç–æ —É–¥–∞–ª—ë–Ω–Ω–æ–≥–æ
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const parseSlides = (text) => {
    console.log('üîç –ù–∞—á–∞–ª–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ —Ç–µ–∫—Å—Ç–∞...');
    
    // ============================================================================
    // –°–¢–†–ê–¢–ï–ì–ò–Ø 1: –¶–∏—Ñ—Ä–∞ –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—Ç—Ä–æ–∫–µ –ü–û–°–õ–ï —Ç–µ–∫—Å—Ç–∞ (–æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–æ—Ä–º–∞—Ç)
    // ============================================================================
    const numberAfterPattern = /\n(\d+)\s*$/gm;
    const matches = [];
    let match;
    
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º lastIndex
    numberAfterPattern.lastIndex = 0;
    
    // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ —Ü–∏—Ñ—Ä—ã –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Å—Ç—Ä–æ–∫–∞—Ö
    while ((match = numberAfterPattern.exec(text)) !== null) {
        matches.push({
            number: match[1],
            index: match.index,
            fullMatch: match[0]
        });
    }
    
    if (matches.length > 0) {
        console.log(`‚úÖ –ù–∞–π–¥–µ–Ω–æ ${matches.length} —Å–ª–∞–π–¥–æ–≤ —Å —Ü–∏—Ñ—Ä–∞–º–∏ –ø–æ—Å–ª–µ —Ç–µ–∫—Å—Ç–∞`);
        return parseNumberAfterSlides(text, matches);
    }
    
    // ============================================================================
    // –°–¢–†–ê–¢–ï–ì–ò–Ø 2: –ü–∞—Ç—Ç–µ—Ä–Ω "–°–ª–∞–π–¥ N" (—Ä–µ–∑–µ—Ä–≤–Ω—ã–π –º–µ—Ç–æ–¥)
    // ============================================================================
    const strictSlidePattern = /(?:^|\n)(—Å–ª–∞–π–¥\s*(\d+))(?:\s+(.*))?/gi;
    const strictMatches = [];
    
    strictSlidePattern.lastIndex = 0;
    
    while ((match = strictSlidePattern.exec(text)) !== null) {
        strictMatches.push({
            index: match.index,
            slideNumber: match[2],
            titleOnSameLine: match[3] ? match[3].trim() : null,
            fullMatch: match[0]
        });
    }
    
    if (strictMatches.length > 0) {
        console.log(`‚úÖ –ù–∞–π–¥–µ–Ω–æ ${strictMatches.length} —Å–ª–∞–π–¥–æ–≤ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–º "–°–ª–∞–π–¥ N"`);
        return parseStrictSlides(text, strictMatches);
    }
    
    // ============================================================================
    // –°–¢–†–ê–¢–ï–ì–ò–Ø 3: –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ (fallback)
    // ============================================================================
    console.log('‚öôÔ∏è –ü—Ä–∏–º–µ–Ω—è–µ–º –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –±–ª–æ–∫–æ–≤...');
    return parseIntelligentSlides(text);
};

// -------------------------------------------------------------------------------
// –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø: –ü–æ–¥—Å—á—ë—Ç —Å–ª–æ–≤ –≤ —Å—Ç—Ä–æ–∫–µ
// -------------------------------------------------------------------------------
const countWords = (str) => {
    // –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã –∏ —Ä–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ —Å–ª–æ–≤–∞
    return str.trim().split(/\s+/).filter(word => word.length > 0).length;
};

// -------------------------------------------------------------------------------
// –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø: –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Å –¥–≤–æ–µ—Ç–æ—á–∏—è–º–∏ –∏ —Å–ø–∏—Å–∫–∞–º–∏
// -------------------------------------------------------------------------------
const formatTextWithLists = (lines) => {
    const formattedLines = [];
    let inList = false;
    let currentListParent = '';
    
    for (let i = 0; i < lines.length; i++) {
        const line = lines[i];
        const trimmed = line.trim();
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –ª–∏ —Å—Ç—Ä–æ–∫–∞ –Ω–∞ –¥–≤–æ–µ—Ç–æ—á–∏–µ
        if (trimmed.endsWith(':')) {
            // –ï—Å–ª–∏ –º—ã –±—ã–ª–∏ –≤ —Å–ø–∏—Å–∫–µ, –∑–∞–≤–µ—Ä—à–∞–µ–º –µ–≥–æ
            if (inList) {
                inList = false;
            }
            
            // –î–µ–ª–∞–µ–º —Å—Ç—Ä–æ–∫—É –∂–∏—Ä–Ω–æ–π (–æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º –≤ **)
            formattedLines.push(`**${trimmed}**`);
            currentListParent = trimmed;
            inList = true;
            continue;
        }
        
        // –ï—Å–ª–∏ –º—ã –≤ —Å–ø–∏—Å–∫–µ –∏ —Å—Ç—Ä–æ–∫–∞ –Ω–µ –ø—É—Å—Ç–∞—è
        if (inList && trimmed !== '') {
            // –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Ä–∫–µ—Ä —Å–ø–∏—Å–∫–∞
            formattedLines.push(`‚Ä¢ ${trimmed}`);
            continue;
        }
        
        // –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ - –≤—ã—Ö–æ–¥–∏–º –∏–∑ —Ä–µ–∂–∏–º–∞ —Å–ø–∏—Å–∫–∞
        if (trimmed === '') {
            inList = false;
            formattedLines.push('');
            continue;
        }
        
        // –û–±—ã—á–Ω–∞—è —Å—Ç—Ä–æ–∫–∞
        formattedLines.push(trimmed);
    }
    
    return formattedLines;
};
// -------------------------------------------------------------------------------
// –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ MAIN –∏ SECONDARY –ø–æ –ø—É—Å—Ç–æ–π —Å—Ç—Ä–æ–∫–µ
// -------------------------------------------------------------------------------
const splitByEmptyLine = (lines) => {
    // –ò—â–µ–º –ø–µ—Ä–≤—É—é –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –ø–æ—Å–ª–µ –Ω–∞—á–∞–ª–∞
    let emptyLineIndex = -1;
    
    for (let i = 0; i < lines.length; i++) {
        if (lines[i] === '') {
            emptyLineIndex = i;
            break;
        }
    }
    
    if (emptyLineIndex === -1) {
        // –ù–µ—Ç –ø—É—Å—Ç—ã—Ö —Å—Ç—Ä–æ–∫ - –≤—Å—ë –≤ MAIN
        return {
            mainText: lines.join('\n'),
            secondaryText: ''
        };
    }
    
    // –ï—Å—Ç—å –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ - –¥–µ–ª–∏–º
    const mainLines = lines.slice(0, emptyLineIndex);
    const secondaryLines = lines.slice(emptyLineIndex + 1).filter(l => l !== '');
    
    return {
        mainText: mainLines.join('\n'),
        secondaryText: secondaryLines.join('\n')
    };
};
          
          // -------------------------------------------------------------------------------
// –ü–∞—Ä—Å–∏–Ω–≥ —Ñ–æ—Ä–º–∞—Ç–∞: —Ç–µ–∫—Å—Ç ‚Üí —Ü–∏—Ñ—Ä–∞ –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—Ç—Ä–æ–∫–µ
// -------------------------------------------------------------------------------
const parseNumberAfterSlides = (text, matches) => {
    const parsedSlides = [];
    
    // –ù–∞—á–∞–ª–æ –ø–µ—Ä–≤–æ–≥–æ —Å–ª–∞–π–¥–∞ - —Å –Ω–∞—á–∞–ª–∞ —Ç–µ–∫—Å—Ç–∞
    let previousEnd = 0;
    
    for (let i = 0; i < matches.length; i++) {
        const currentMatch = matches[i];
        
        // –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç –æ—Ç –Ω–∞—á–∞–ª–∞ (–∏–ª–∏ –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Ü–∏—Ñ—Ä—ã) –¥–æ —Ç–µ–∫—É—â–µ–π —Ü–∏—Ñ—Ä—ã
        const slideContent = text.substring(previousEnd, currentMatch.index).trim();
        
        if (slideContent) {
            // –†–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ —Å—Ç—Ä–æ–∫–∏
            const allLines = slideContent.split('\n').map(l => l.trim());
            
            let title = '';
            let mainText = '';
            let secondaryText = '';
            
            if (allLines.length > 0) {
                const firstLine = allLines[0];
                const wordCount = countWords(firstLine);
                
                // –ü–†–ê–í–ò–õ–û 1: –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —Å–ª–æ–≤
                if (wordCount <= 6) {
                    // ‚â§ 6 —Å–ª–æ–≤ ‚Üí TITLE
                    title = firstLine;
                    
                    // –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ ‚Üí –≤—Å—ë –≤ MAIN TEXT
                    const remainingLines = allLines.slice(1);
                    const formattedLines = formatTextWithLists(remainingLines);
                    mainText = formattedLines.join('\n');
                    secondaryText = '';
                    
                } else {
                    // ‚â• 7 —Å–ª–æ–≤ ‚Üí –≤—Å—ë –≤ MAIN TEXT, –∑–∞–≥–æ–ª–æ–≤–∫–∞ –Ω–µ—Ç
                    title = '';
                    
                    // –í—Å–µ —Å—Ç—Ä–æ–∫–∏ ‚Üí –≤ MAIN TEXT
                    const formattedLines = formatTextWithLists(allLines);
                    mainText = formattedLines.join('\n');
                    secondaryText = '';
                }
            }
            
            parsedSlides.push(createSlideObject({
                id: currentMatch.number,
                title,
                mainText,
                accentText: '',
                secondaryText
            }));
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–ª–∞–π–¥–∞
        previousEnd = currentMatch.index + currentMatch.fullMatch.length;
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Ç–µ–∫—Å—Ç –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Ü–∏—Ñ—Ä—ã
    const remainingText = text.substring(previousEnd).trim();
    if (remainingText) {
        const allLines = remainingText.split('\n').map(l => l.trim());
        
        if (allLines.length > 0) {
            const firstLine = allLines[0];
            const wordCount = countWords(firstLine);
            
            let title = '';
            let mainText = '';
            let secondaryText = '';
            
            if (wordCount <= 6) {
                title = firstLine;
                const remainingLines = allLines.slice(1);
                const formattedLines = formatTextWithLists(remainingLines);
                mainText = formattedLines.join('\n');
                secondaryText = '';
            } else {
                title = '';
                const formattedLines = formatTextWithLists(allLines);
                mainText = formattedLines.join('\n');
                secondaryText = '';
            }
            
            parsedSlides.push(createSlideObject({
                id: String(parsedSlides.length + 1),
                title,
                mainText,
                accentText: '',
                secondaryText
            }));
        }
    }
    
    return parsedSlides;
};
          
          // -------------------------------------------------------------------------------
// –ü–∞—Ä—Å–∏–Ω–≥ –ø–æ —Å—Ç—Ä–æ–≥–æ–º—É –ø–∞—Ç—Ç–µ—Ä–Ω—É "–°–ª–∞–π–¥ N" (—Ä–µ–∑–µ—Ä–≤–Ω—ã–π –º–µ—Ç–æ–¥)
// -------------------------------------------------------------------------------
const parseStrictSlides = (text, slideMatches) => {
    const parsedSlides = [];
    
    for (let i = 0; i < slideMatches.length; i++) {
        const currentMatch = slideMatches[i];
        const nextMatch = slideMatches[i + 1];
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞—á–∞–ª–æ –∏ –∫–æ–Ω–µ—Ü —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Å–ª–∞–π–¥–∞
        const contentStart = currentMatch.index + currentMatch.fullMatch.length;
        const contentEnd = nextMatch ? nextMatch.index : text.length;
        
        // –ò–∑–≤–ª–µ–∫–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–ª–∞–π–¥–∞
        let slideContent = text.substring(contentStart, contentEnd).trim();
        
        // –ï—Å–ª–∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –±—ã–ª –Ω–∞ —Ç–æ–π –∂–µ —Å—Ç—Ä–æ–∫–µ, –¥–æ–±–∞–≤–ª—è–µ–º –µ–≥–æ –≤ –Ω–∞—á–∞–ª–æ
        if (currentMatch.titleOnSameLine) {
            slideContent = currentMatch.titleOnSameLine + '\n' + slideContent;
        }
        
        // –†–∞–∑–±–∏–≤–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –Ω–∞ —Å—Ç—Ä–æ–∫–∏
        const allLines = slideContent.split('\n').map(l => l.trim());
        
        let title = '';
        let mainText = '';
        let secondaryText = '';
        
        if (allLines.length > 0) {
            const firstLine = allLines[0];
            const wordCount = countWords(firstLine);
            
            if (wordCount <= 6) {
                title = firstLine;
                const remainingLines = allLines.slice(1);
                const formattedLines = formatTextWithLists(remainingLines);
                mainText = formattedLines.join('\n');
                secondaryText = '';
            } else {
                title = '';
                const formattedLines = formatTextWithLists(allLines);
                mainText = formattedLines.join('\n');
                secondaryText = '';
            }
        }
        
        parsedSlides.push(createSlideObject({
            id: currentMatch.slideNumber,
            title,
            mainText,
            accentText: '',
            secondaryText
        }));
    }
    
    return parsedSlides;
};
          
          // -------------------------------------------------------------------------------
// –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ –±–ª–æ–∫–æ–≤ (fallback –º–µ—Ç–æ–¥)
// -------------------------------------------------------------------------------
const parseIntelligentSlides = (text) => {
    // –¢–∏–ø—ã –±–ª–æ–∫–æ–≤
    const BlockType = {
        SLIDE_START: 'SLIDE_START',
        TITLE: 'TITLE',
        MAIN: 'MAIN',
        ACCENT: 'ACCENT',
        SECONDARY: 'SECONDARY'
    };
    
    // –†–∞–∑–±–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç –Ω–∞ –±–ª–æ–∫–∏
    const rawBlocks = text.split(/\n\s*\n/).filter(block => block.trim());
    
    // –ö–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ–º –±–ª–æ–∫–∏
    const classifiedBlocks = rawBlocks.map(block => {
        const trimmed = block.trim();
        const firstLine = trimmed.split('\n')[0].trim();
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞—á–∞–ª–æ –Ω–æ–≤–æ–≥–æ —Å–ª–∞–π–¥–∞
        if (/^(?:—Å–ª–∞–π–¥|slide)\s*\d+/i.test(firstLine) ||
            /^\d+\./.test(firstLine) ||
            /^#{1,3}\s/.test(firstLine)) {
            return { text: trimmed, type: BlockType.SLIDE_START };
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∑–∞–≥–æ–ª–æ–≤–æ–∫ (markdown –∏–ª–∏ CAPS)
        if (/^#{1,3}\s/.test(firstLine) || 
            (firstLine === firstLine.toUpperCase() && 
             firstLine.length > 3 && 
             firstLine.length < 100 &&
             /^[A-Z–ê-–Ø–Å\s\d.,!?-]+$/.test(firstLine))) {
            return { text: trimmed, type: BlockType.TITLE };
        }
        
        // –í—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ –∏–¥—ë—Ç –≤ MAIN
        return { text: trimmed, type: BlockType.MAIN };
    });
    
    // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –±–ª–æ–∫–∏ –≤ —Å–ª–∞–π–¥—ã
    const slides = [];
    let currentSlide = null;
    let slideCounter = 0;
    
    classifiedBlocks.forEach(block => {
        // –ù–∞—á–∞–ª–æ –Ω–æ–≤–æ–≥–æ —Å–ª–∞–π–¥–∞
        if (block.type === BlockType.SLIDE_START || 
            (block.type === BlockType.TITLE && currentSlide !== null)) {
            
            if (currentSlide) {
                slides.push(currentSlide);
            }
            
            slideCounter++;
            currentSlide = {
                id: String(slideCounter),
                title: '',
                mainText: '',
                accentText: '',
                secondaryText: ''
            };
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞ –Ω–∞—á–∞–ª–∞ —Å–ª–∞–π–¥–∞
            let content = block.text;
            content = content.replace(/^(?:—Å–ª–∞–π–¥|slide)\s*\d+[:\s]*/i, '');
            content = content.replace(/^\d+\.\s*/, '');
            content = content.replace(/^#{1,3}\s*/, '');
            
            if (content.trim()) {
                const wordCount = countWords(content);
                if (wordCount <= 6) {
                    currentSlide.title = content.trim();
                } else {
                    currentSlide.mainText = content.trim();
                }
            }
            return;
        }
        
        // –ï—Å–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤—ã–π –±–ª–æ–∫ –∏ –Ω–µ—Ç —Ç–µ–∫—É—â–µ–≥–æ —Å–ª–∞–π–¥–∞
        if (!currentSlide) {
            slideCounter++;
            currentSlide = {
                id: String(slideCounter),
                title: '',
                mainText: '',
                accentText: '',
                secondaryText: ''
            };
        }
        
        // –í–µ—Å—å –∫–æ–Ω—Ç–µ–Ω—Ç –∏–¥—ë—Ç –≤ MAIN TEXT
        let content = block.text.replace(/^#{1,3}\s*/, '');
        
        if (block.type === BlockType.TITLE && !currentSlide.title) {
            const wordCount = countWords(content);
            if (wordCount <= 6) {
                currentSlide.title = content;
            } else {
                currentSlide.mainText += (currentSlide.mainText ? '\n\n' : '') + content;
            }
        } else {
            currentSlide.mainText += (currentSlide.mainText ? '\n\n' : '') + content;
        }
    });
    
    // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π —Å–ª–∞–π–¥
    if (currentSlide) {
        slides.push(currentSlide);
    }
    
    // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ –Ω–∏ –æ–¥–Ω–æ–≥–æ —Å–ª–∞–π–¥–∞, —Å–æ–∑–¥–∞—ë–º –æ–¥–∏–Ω
    if (slides.length === 0) {
        const allText = text.trim();
        if (allText) {
            const firstLine = allText.split('\n')[0];
            const wordCount = countWords(firstLine);
            
            if (wordCount <= 6) {
                slides.push({
                    id: '1',
                    title: firstLine,
                    mainText: allText.substring(firstLine.length).trim(),
                    accentText: '',
                    secondaryText: ''
                });
            } else {
                slides.push({
                    id: '1',
                    title: '',
                    mainText: allText,
                    accentText: '',
                    secondaryText: ''
                });
            }
        }
    }
    
    console.log(`‚úÖ –°–æ–∑–¥–∞–Ω–æ ${slides.length} —Å–ª–∞–π–¥–æ–≤ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–º –º–µ—Ç–æ–¥–æ–º`);
    return slides.map(slide => createSlideObject(slide));
};
          
// -------------------------------------------------------------------------------
// –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ —Å–ª–∞–π–¥–∞ —Å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
// -------------------------------------------------------------------------------
const createSlideObject = (slideData) => {
    return {
        id: slideData.id || '1',
        title: slideData.title || '',
        mainText: slideData.mainText || '',
        accentText: slideData.accentText || '', // –í—Å–µ–≥–¥–∞ –ø—É—Å—Ç–æ–π
        secondaryText: slideData.secondaryText || '',
        titleAlign: 'left',
        mainTextAlign: 'left',
        accentAlign: 'left',
        secondaryTextAlign: 'left',
        bgType: 'solid',
        bgColor1: '#1e40af',
        bgColor2: '#7c3aed',
        bgImage: null,
        fontFamily: 'Inter',
        titleFontSize: 130,
        mainFontSize: 75,
        accentFontSize: 70,
        accentBgColor: '#fbbf24',
        textColor: '#ffffff',
        accentTextColor: '#000000'
    };
};

            const handleImport = () => {
                const text = importTextRef.current.value;
                if (text.trim()) {
                    const parsedSlides = parseSlides(text);
                    
                    if (parsedSlides.length === 0) {
                        alert('–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ —Å–ª–∞–π–¥—ã –≤ —Ç–µ–∫—Å—Ç–µ. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —Ñ–æ—Ä–º–∞—Ç "–°–ª–∞–π–¥ 1", "–°–ª–∞–π–¥ 2" –∏ —Ç.–¥.');
                        return;
                    }
                    
                    setSlides(parsedSlides);
                    setMode('edit');
                    setCurrentSlideIndex(0);
                    
                    // –ü–µ—Ä–≤–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∏–º–ø–æ—Ä—Ç–∞
                    setTimeout(() => {
                        const projectData = {
                            projectName,
                            aspectRatio,
                            currentSlideIndex: 0,
                            slides: parsedSlides
                        };
                        ProjectUtils.saveProject(projectName, projectData);
                        setLastSaveTime(Date.now());
                    }, 1000);
                }
            };

            const updateCurrentSlide = (field, value) => {
                const updatedSlides = [...slides];
                updatedSlides[currentSlideIndex] = {
                    ...updatedSlides[currentSlideIndex],
                    [field]: value
                };
                setSlides(updatedSlides);
            };

            const createNewSlide = () => {
                const newSlide = {
                    id: String(slides.length + 1),
                    title: '',
                    mainText: '',
                    accentText: '',
                    secondaryText: '',
                    titleAlign: 'left',
                    mainTextAlign: 'left',
                    accentAlign: 'left',
                    secondaryTextAlign: 'left',
                    bgType: currentSlide.bgType || 'solid',
                    bgColor1: currentSlide.bgColor1 || '#1e40af',
                    bgColor2: currentSlide.bgColor2 || '#7c3aed',
                    bgImage: null,
                    fontFamily: currentSlide.fontFamily || 'Inter',
                    titleFontSize: currentSlide.titleFontSize || 130,
                    mainFontSize: currentSlide.mainFontSize || 75,
                    accentFontSize: currentSlide.accentFontSize || 70,
                    accentBgColor: currentSlide.accentBgColor || '#fbbf24',
                    textColor: currentSlide.textColor || '#ffffff',
                    accentTextColor: currentSlide.accentTextColor || '#000000'
                };
                
                const updatedSlides = [...slides];
                updatedSlides.splice(currentSlideIndex + 1, 0, newSlide);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º ID —Å–ª–∞–π–¥–æ–≤
                updatedSlides.forEach((slide, index) => {
                    slide.id = String(index + 1);
                });
                
                setSlides(updatedSlides);
                setCurrentSlideIndex(currentSlideIndex + 1);
            };

            const handleDeleteSlideRequest = () => {
                setSlideToDelete(currentSlideIndex);
                setShowConfirmDeleteSlide(true);
            };

            const handleConfirmDeleteSlide = () => {
                if (slides.length <= 1) {
                    alert('–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π —Å–ª–∞–π–¥ –≤ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏.');
                    setShowConfirmDeleteSlide(false);
                    return;
                }
                
                const updatedSlides = slides.filter((_, index) => index !== slideToDelete);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º ID —Å–ª–∞–π–¥–æ–≤
                updatedSlides.forEach((slide, index) => {
                    slide.id = String(index + 1);
                });
                
                setSlides(updatedSlides);
                
                // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º —Ç–µ–∫—É—â–∏–π –∏–Ω–¥–µ–∫—Å
                if (slideToDelete === slides.length - 1) {
                    setCurrentSlideIndex(Math.max(0, slideToDelete - 1));
                } else {
                    setCurrentSlideIndex(Math.min(slideToDelete, updatedSlides.length - 1));
                }
                
                setShowConfirmDeleteSlide(false);
                setSlideToDelete(null);
            };

            const exportProjectToFile = () => {
                const projectData = {
                    projectName,
                    aspectRatio,
                    currentSlideIndex,
                    slides,
                    exportDate: Date.now(),
                    version: '1.0'
                };
                
                const jsonString = JSON.stringify(projectData, null, 2);
                const blob = new Blob([jsonString], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                const safeProjectName = getSafeFileName(projectName);
                link.download = `${safeProjectName}_project.json`;
                link.href = url;
                link.click();
                URL.revokeObjectURL(url);
            };

            const handleImportProjectFile = (event) => {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const projectData = JSON.parse(e.target.result);
                        
                        // –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
                        if (!projectData.projectName || !projectData.slides || !Array.isArray(projectData.slides)) {
                            alert('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞ –ø—Ä–æ–µ–∫—Ç–∞.');
                            return;
                        }
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –ø—Ä–æ–µ–∫—Ç —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º
                        if (ProjectUtils.projectExists(projectData.projectName)) {
                            const confirmOverwrite = window.confirm(
                                `–ü—Ä–æ–µ–∫—Ç "${projectData.projectName}" —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ. –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ–µ–∫—Ç –∏–∑ —Ñ–∞–π–ª–∞?`
                            );
                            if (!confirmOverwrite) {
                                return;
                            }
                        }
                        
                        // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–æ–µ–∫—Ç
                        setProjectName(projectData.projectName);
                        const tabId = ProjectUtils.setSessionLock(projectData.projectName);
                        setSessionId(tabId);
                        setAspectRatio(projectData.aspectRatio || '16:9');
                        setCurrentSlideIndex(projectData.currentSlideIndex || 0);
                        setSlides(projectData.slides);
                        setMode('edit');
                        
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
                        ProjectUtils.saveProject(projectData.projectName, projectData);
                        
                    } catch (error) {
                        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –ø—Ä–æ–µ–∫—Ç–∞:', error);
                        alert('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ–µ–∫—Ç. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.');
                    }
                };
                reader.readAsText(file);
                event.target.value = ''; // –°–±—Ä–æ—Å input
            };

            const currentSlide = slides[currentSlideIndex] || {};

            const getSlideBackground = () => {
                const bgType = currentSlide.bgType || 'solid';
                const bgImage = currentSlide.bgImage;
                const bgColor1 = currentSlide.bgColor1 || '#1e40af';
                const bgColor2 = currentSlide.bgColor2 || '#7c3aed';
                
                if (bgType === 'image' && bgImage) {
                    return {
                        backgroundImage: `url(${bgImage})`,
                        backgroundSize: 'cover',
                        backgroundPosition: 'center',
                        backgroundRepeat: 'no-repeat'
                    };
                } else if (bgType === 'solid') {
                    return { backgroundColor: bgColor1 };
                } else {
                    return {
                        backgroundImage: `linear-gradient(135deg, ${bgColor1} 0%, ${bgColor2} 100%)`
                    };
                }
            };

            const handleImageSelect = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        setPendingImage(event.target.result);
                        setShowImageModal(true);
                    };
                    reader.readAsDataURL(file);
                }
                e.target.value = '';
            };

            const applyImageToCurrentSlide = () => {
                const settings = {
                    bgImage: pendingImage,
                    bgType: 'image'
                };
                applyToCurrentSlide(settings);
                setShowImageModal(false);
                setPendingImage(null);
            };

            const applyImageToAllSlides = () => {
                const settings = {
                    bgImage: pendingImage,
                    bgType: 'image'
                };
                applyToAllSlides(settings);
                setShowImageModal(false);
                setPendingImage(null);
            };

            const applyImageToFollowingSlides = () => {
                const settings = {
                    bgImage: pendingImage,
                    bgType: 'image'
                };
                applyToCurrentAndFollowing(settings);
                setShowImageModal(false);
                setPendingImage(null);
            };

            const cancelImageUpload = () => {
                setShowImageModal(false);
                setPendingImage(null);
            };

            const removeBackgroundImage = (applyTo) => {
                const settings = {
                    bgImage: null,
                    bgType: 'solid'
                };
                if (applyTo === 'all') {
                    applyToAllSlides(settings);
                } else if (applyTo === 'following') {
                    applyToCurrentAndFollowing(settings);
                } else {
                    applyToCurrentSlide(settings);
                }
            };

            const getAspectRatioClass = () => {
                switch(aspectRatio) {
                    case '16:9':
                        return 'aspect-video';
                    case '1:1':
                        return 'aspect-square';
                    case '4:3':
                        return 'aspect-[4/3]';
                    default:
                        return 'aspect-video';
                }
            };

            const getCanvasDimensions = () => {
                switch(aspectRatio) {
                    case '16:9':
                        return { width: 1920, height: 1080 };
                    case '1:1':
                        return { width: 1080, height: 1080 };
                    case '4:3':
                        return { width: 1440, height: 1080 };
                    default:
                        return { width: 1920, height: 1080 };
                }
            };

            const getSafeFileName = (name) => {
                return name.replace(/\s+/g, '_').replace(ProjectUtils.FORBIDDEN_CHARS, '_');
            };

            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
            const renderFormattedText = (text, style, className = '') => {
                if (!text) return null;
                
                // –†–∞–∑–±–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç –Ω–∞ —á–∞—Å—Ç–∏, —É—á–∏—Ç—ã–≤–∞—è –∂–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç (**—Ç–µ–∫—Å—Ç**) –∏ –±—É–ª–ª–∏—Ç—ã
                const lines = text.split('\n');
                
                return (
                    <div className={className} style={{ ...style, whiteSpace: 'pre-wrap' }}>
                        {lines.map((line, lineIndex) => {
                            // –ï—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞ –ø—É—Å—Ç–∞—è, —Ä–µ–Ω–¥–µ—Ä–∏–º –µ—ë –∫–∞–∫ –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É (—Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–æ–±–µ–ª—ã)
                            if (line.trim() === '') {
                                return <div key={lineIndex}>&nbsp;</div>;
                            }
                            
                            const trimmedLine = line.trim();
                            
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å—Ç—Ä–æ–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–º —Å–ø–∏—Å–∫–∞
                            const isBullet = trimmedLine.startsWith('‚Ä¢ ') || trimmedLine.startsWith('- ') || trimmedLine.startsWith('* ');
                            
                            if (isBullet) {
                                // –£–±–∏—Ä–∞–µ–º –±—É–ª–ª–∏—Ç –∏–∑ –Ω–∞—á–∞–ª–∞ —Å—Ç—Ä–æ–∫–∏
                                const bulletText = trimmedLine.substring(2);
                                const parts = parseBoldText(bulletText);
                                
                                return (
                                    <div key={lineIndex} style={{ display: 'flex', marginBottom: '0.3em' }}>
                                        <span style={{ marginRight: '0.5em', flexShrink: 0 }}>‚Ä¢</span>
                                        <span>{parts}</span>
                                    </div>
                                );
                            } else {
                                // –û–±—ã—á–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ - —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ –ø—Ä–æ–±–µ–ª—ã
                                const parts = parseBoldText(line);
                                return <div key={lineIndex}>{parts}</div>;
                            }
                        })}
                    </div>
                );
            };
            
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –∂–∏—Ä–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
            const parseBoldText = (text) => {
                const parts = [];
                let currentIndex = 0;
                const boldPattern = /\*\*(.*?)\*\*/g;
                let match;
                
                while ((match = boldPattern.exec(text)) !== null) {
                    // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –¥–æ –∂–∏—Ä–Ω–æ–≥–æ
                    if (match.index > currentIndex) {
                        parts.push(text.substring(currentIndex, match.index));
                    }
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –∂–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç
                    parts.push(<strong key={match.index}>{match[1]}</strong>);
                    
                    currentIndex = match.index + match[0].length;
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ—Å—Ç–∞–≤—à–∏–π—Å—è —Ç–µ–∫—Å—Ç
                if (currentIndex < text.length) {
                    parts.push(text.substring(currentIndex));
                }
                
                return parts.length > 0 ? parts : text;
            };

            const AlignmentToggle = ({ value, onChange }) => {
                return (
                    <div className="flex gap-1 bg-gray-100 p-1 rounded-md">
                        <button
                            onClick={() => onChange('left')}
                            className={`px-3 py-1 rounded transition-colors ${
                                value === 'left' 
                                    ? 'bg-white shadow-sm text-blue-600' 
                                    : 'hover:bg-gray-50 text-gray-600'
                            }`}
                            title="–ü–æ –ª–µ–≤–æ–º—É –∫—Ä–∞—é"
                        >
                            ‚Üê
                        </button>
                        <button
                            onClick={() => onChange('center')}
                            className={`px-3 py-1 rounded transition-colors ${
                                value === 'center' 
                                    ? 'bg-white shadow-sm text-blue-600' 
                                    : 'hover:bg-gray-50 text-gray-600'
                            }`}
                            title="–ü–æ —Ü–µ–Ω—Ç—Ä—É"
                        >
                            ‚Üî
                        </button>
                    </div>
                );
            };

            // –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ (–∂–∏—Ä–Ω—ã–π –∏ –º–∞—Ä–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫)
            const TextFormattingToolbar = ({ textareaRef, onTextChange }) => {
                
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≥–æ—Ä—è—á–∏—Ö –∫–ª–∞–≤–∏—à
                useEffect(() => {
                    const handleKeyDown = (e) => {
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ñ–æ–∫—É—Å –Ω–∞ –Ω—É–∂–Ω–æ–º textarea
                        if (document.activeElement !== textareaRef.current) return;
                        
                        // Ctrl+B –∏–ª–∏ Cmd+B –¥–ª—è –∂–∏—Ä–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
                        if ((e.ctrlKey || e.metaKey) && e.key === 'b') {
                            e.preventDefault();
                            applyBold();
                        }
                    };
                    
                    const textarea = textareaRef.current;
                    if (textarea) {
                        textarea.addEventListener('keydown', handleKeyDown);
                        return () => textarea.removeEventListener('keydown', handleKeyDown);
                    }
                }, [textareaRef]);
                
                const applyBold = () => {
                    if (!textareaRef.current) return;
                    
                    const textarea = textareaRef.current;
                    const start = textarea.selectionStart;
                    const end = textarea.selectionEnd;
                    const selectedText = textarea.value.substring(start, end);
                    
                    if (!selectedText) {
                        alert('–í—ã–¥–µ–ª–∏—Ç–µ —Ç–µ–∫—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π —Ö–æ—Ç–∏—Ç–µ —Å–¥–µ–ª–∞—Ç—å –∂–∏—Ä–Ω—ã–º');
                        return;
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –∂–∏—Ä–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
                    const beforeSelection = textarea.value.substring(Math.max(0, start - 2), start);
                    const afterSelection = textarea.value.substring(end, Math.min(textarea.value.length, end + 2));
                    
                    let newText;
                    let newSelectionStart;
                    let newSelectionEnd;
                    
                    // –°–õ–£–ß–ê–ô 1: –í—ã–¥–µ–ª–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç —Å–∞–º —Å–æ–¥–µ—Ä–∂–∏—Ç ** –≤ –Ω–∞—á–∞–ª–µ –∏ –∫–æ–Ω—Ü–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä: **—Ç–µ–∫—Å—Ç**)
                    if (selectedText.startsWith('**') && selectedText.endsWith('**') && selectedText.length > 4) {
                        // –£–±–∏—Ä–∞–µ–º ** –∏–∑–Ω—É—Ç—Ä–∏ –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
                        const unwrappedText = selectedText.substring(2, selectedText.length - 2);
                        newText = textarea.value.substring(0, start) + unwrappedText + textarea.value.substring(end);
                        newSelectionStart = start;
                        newSelectionEnd = start + unwrappedText.length;
                    }
                    // –°–õ–£–ß–ê–ô 2: –¢–µ–∫—Å—Ç –æ–∫—Ä—É–∂—ë–Ω ** —Å–Ω–∞—Ä—É–∂–∏ (–¥–æ –∏ –ø–æ—Å–ª–µ –≤—ã–¥–µ–ª–µ–Ω–∏—è)
                    else if (beforeSelection === '**' && afterSelection === '**') {
                        // –£–±–∏—Ä–∞–µ–º ** —Å –æ–±–µ–∏—Ö —Å—Ç–æ—Ä–æ–Ω
                        newText = textarea.value.substring(0, start - 2) + selectedText + textarea.value.substring(end + 2);
                        newSelectionStart = start - 2;
                        newSelectionEnd = end - 2;
                    }
                    // –°–õ–£–ß–ê–ô 3: –¢–µ–∫—Å—Ç –æ–±—ã—á–Ω—ã–π - –¥–µ–ª–∞–µ–º –∂–∏—Ä–Ω—ã–º
                    else {
                        const boldText = `**${selectedText}**`;
                        newText = textarea.value.substring(0, start) + boldText + textarea.value.substring(end);
                        newSelectionStart = start;
                        newSelectionEnd = start + boldText.length;
                    }
                    
                    onTextChange(newText);
                    
                    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–æ–∫—É—Å –∏ –≤—ã–¥–µ–ª–µ–Ω–∏–µ
                    setTimeout(() => {
                        textarea.focus();
                        textarea.setSelectionRange(newSelectionStart, newSelectionEnd);
                    }, 0);        
                };
                
                const applyBulletList = () => {
                    if (!textareaRef.current) return;
                    
                    const textarea = textareaRef.current;
                    const start = textarea.selectionStart;
                    const end = textarea.selectionEnd;
                    const selectedText = textarea.value.substring(start, end);
                    
                    if (!selectedText) {
                        alert('–í—ã–¥–µ–ª–∏—Ç–µ —Ç–µ–∫—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π —Ö–æ—Ç–∏—Ç–µ –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å –≤ —Å–ø–∏—Å–æ–∫');
                        return;
                    }
                    
                    // –†–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ —Å—Ç—Ä–æ–∫–∏ (—Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏)
                    const lines = selectedText.split('\n');
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—Å–µ –ª–∏ –Ω–µ–ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ —É–∂–µ –∏–º–µ—é—Ç –±—É–ª–ª–∏—Ç—ã
                    const nonEmptyLines = lines.filter(line => line.trim() !== '');
                    const allHaveBullets = nonEmptyLines.every(line => {
                        const trimmed = line.trim();
                        return trimmed.startsWith('‚Ä¢ ') || trimmed.startsWith('- ') || trimmed.startsWith('* ');
                    });
                    
                    let processedList;
                    
                    if (allHaveBullets && nonEmptyLines.length > 0) {
                        // –£–ë–ò–†–ê–ï–ú –±—É–ª–ª–∏—Ç—ã - –≤—Å–µ —Å—Ç—Ä–æ–∫–∏ —Å –±—É–ª–ª–∏—Ç–∞–º–∏, —É–±–∏—Ä–∞–µ–º –∏—Ö
                        processedList = lines.map(line => {
                            if (line.trim() === '') return line; // –ü—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å
                            
                            const trimmed = line.trim();
                            // –£–±–∏—Ä–∞–µ–º –±—É–ª–ª–∏—Ç—ã —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤
                            if (trimmed.startsWith('‚Ä¢ ')) {
                                return line.replace('‚Ä¢ ', '');
                            } else if (trimmed.startsWith('- ')) {
                                return line.replace('- ', '');
                            } else if (trimmed.startsWith('* ')) {
                                return line.replace('* ', '');
                            }
                            return line;
                        }).join('\n');
                    } else {
                        // –î–û–ë–ê–í–õ–Ø–ï–ú –±—É–ª–ª–∏—Ç—ã
                        processedList = lines.map(line => {
                            if (line.trim() === '') return line; // –ü—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å
                            
                            const trimmed = line.trim();
                            // –ï—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å –±—É–ª–ª–∏—Ç, –Ω–µ –¥–æ–±–∞–≤–ª—è–µ–º
                            if (trimmed.startsWith('‚Ä¢ ') || trimmed.startsWith('- ') || trimmed.startsWith('* ')) {
                                return line;
                            }
                            // –î–æ–±–∞–≤–ª—è–µ–º –±—É–ª–ª–∏—Ç —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –æ—Ç—Å—Ç—É–ø–æ–≤
                            const leadingSpaces = line.match(/^\s*/)[0];
                            return leadingSpaces + '‚Ä¢ ' + trimmed;
                        }).join('\n');
                    }
                    
                    const newText = textarea.value.substring(0, start) + processedList + textarea.value.substring(end);
                    
                    onTextChange(newText);
                    
                    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–æ–∫—É—Å
                    setTimeout(() => {
                        textarea.focus();
                        textarea.setSelectionRange(start, start + processedList.length);
                    }, 0);
                };
                
                return (
                    <div className="flex gap-1 bg-gray-100 p-1 rounded-md">
                        <button
                            onClick={applyBold}
                            className="px-3 py-1 rounded hover:bg-white transition-colors text-gray-700 font-bold"
                            title="–ñ–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç (Ctrl/Cmd + B)"
                        >
                            B
                        </button>
                        <button
                            onClick={applyBulletList}
                            className="px-3 py-1 rounded hover:bg-white transition-colors text-gray-700"
                            title="–ú–∞—Ä–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ (–≤—ã–¥–µ–ª–∏—Ç–µ —Ç–µ–∫—Å—Ç)"
                        >
                            ‚ãÆ
                        </button>
                    </div>
                );
            };

            const FontSizeSlider = ({ label, value, onChange, min, max }) => {
                return (
                    <div>
                        <div className="flex justify-between items-center mb-2">
                            <label className="block text-sm font-medium text-gray-600">
                                {label}
                            </label>
                            <span className="text-sm font-semibold text-blue-600 bg-blue-50 px-2 py-1 rounded">
                                {value}px
                            </span>
                        </div>
                        <input
                            type="range"
                            min={min}
                            max={max}
                            value={value}
                            onChange={(e) => onChange(parseInt(e.target.value))}
                            className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-600"
                        />
                        <div className="flex justify-between text-xs text-gray-400 mt-1">
                            <span>{min}px</span>
                            <span>{max}px</span>
                        </div>
                    </div>
                );
            };

            const ApplyButtons = ({ onApplyCurrent, onApplyAll, settingKey, settingName }) => {
                if (!changedSettings[settingKey]) return null;
                
                return (
                    <div className="mt-3 p-4 bg-gradient-to-r from-amber-50 to-orange-50 rounded-lg border-2 border-amber-400 shadow-lg">
                        <p className="text-sm text-gray-800 mb-3 font-semibold flex items-center gap-2">
                            <span className="inline-block w-2 h-2 bg-amber-500 rounded-full animate-pulse"></span>
                            –ü—Ä–∏–º–µ–Ω–∏—Ç—å {settingName || '–∏–∑–º–µ–Ω–µ–Ω–∏—è'}?
                        </p>
                        <div className="space-y-2">
                            <div className="flex gap-2">
                                <button
                                    onClick={() => {
                                        onApplyCurrent();
                                        clearSettingChange(settingKey);
                                    }}
                                    className="flex-1 px-4 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all text-sm font-semibold shadow-md hover:shadow-lg transform hover:scale-105"
                                >
                                    –¢–æ–ª—å–∫–æ —ç—Ç–æ—Ç —Å–ª–∞–π–¥
                                </button>
                                <button
                                    onClick={() => {
                                        onApplyAll();
                                        clearSettingChange(settingKey);
                                    }}
                                    className="flex-1 px-4 py-2.5 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-all text-sm font-semibold shadow-md hover:shadow-lg transform hover:scale-105"
                                >
                                    –≠—Ç–æ—Ç –∏ —Å–ª–µ–¥—É—é—â–∏–µ
                                </button>
                            </div>
                            <button
                                onClick={() => clearSettingChange(settingKey)}
                                className="w-full px-4 py-2 bg-gray-100 text-gray-600 rounded-lg hover:bg-gray-200 transition-colors text-sm font-medium border border-gray-300"
                            >
                                –ù–µ –ø—Ä–∏–º–µ–Ω—è—Ç—å
                            </button>
                        </div>
                    </div>
                );
            };

            const renderSlideToCanvas = async (slide, slideIndex) => {
                const originalIndex = currentSlideIndex;
                setCurrentSlideIndex(slideIndex);
                
                await new Promise(resolve => setTimeout(resolve, 100));
                
                if (!slideRef.current) return null;
                
                try {
                    const dimensions = getCanvasDimensions();
                    const scale = dimensions.width / slideRef.current.offsetWidth;
                    
                    const canvas = await html2canvas(slideRef.current, {
                        scale: scale,
                        width: slideRef.current.offsetWidth,
                        height: slideRef.current.offsetHeight,
                        backgroundColor: null,
                        logging: false,
                        useCORS: true,
                        allowTaint: true
                    });
                    
                    setCurrentSlideIndex(originalIndex);
                    return canvas;
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–µ —Å–ª–∞–π–¥–∞:', error);
                    setCurrentSlideIndex(originalIndex);
                    return null;
                }
            };

            const exportCurrentSlide = async () => {
                if (!slideRef.current) return;
                
                try {
                    const dimensions = getCanvasDimensions();
                    const scale = dimensions.width / slideRef.current.offsetWidth;
                    
                    const canvas = await html2canvas(slideRef.current, {
                        scale: scale,
                        width: slideRef.current.offsetWidth,
                        height: slideRef.current.offsetHeight,
                        backgroundColor: null,
                        logging: false,
                        useCORS: true,
                        allowTaint: true
                    });
                    
                    canvas.toBlob((blob) => {
                        const url = URL.createObjectURL(blob);
                        const link = document.createElement('a');
                        const safeProjectName = getSafeFileName(projectName);
                        link.download = `${safeProjectName}_slide_${currentSlide.id || currentSlideIndex + 1}.png`;
                        link.href = url;
                        link.click();
                        URL.revokeObjectURL(url);
                    });
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ:', error);
                    alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
                }
            };

            const exportAllSlidesAsZip = async () => {
                setIsExporting(true);
                setExportProgress(0);
                
                try {
                    const zip = new JSZip();
                    const folder = zip.folder('slides');
                    
                    for (let i = 0; i < slides.length; i++) {
                        setExportProgress(Math.round(((i + 1) / slides.length) * 100));
                        
                        const canvas = await renderSlideToCanvas(slides[i], i);
                        if (canvas) {
                            const blob = await new Promise(resolve => canvas.toBlob(resolve));
                            folder.file(`slide-${slides[i].id || i + 1}.png`, blob);
                        }
                    }
                    
                    const content = await zip.generateAsync({ type: 'blob' });
                    const url = URL.createObjectURL(content);
                    const link = document.createElement('a');
                    const safeProjectName = getSafeFileName(projectName);
                    link.download = `${safeProjectName}_all_slides.zip`;
                    link.href = url;
                    link.click();
                    URL.revokeObjectURL(url);
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ ZIP:', error);
                    alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∞—Ä—Ö–∏–≤–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
                } finally {
                    setIsExporting(false);
                    setExportProgress(0);
                }
            };

            const exportAllSlidesAsPDF = async () => {
                setIsExporting(true);
                setExportProgress(0);
                
                try {
                    const dimensions = getCanvasDimensions();
                    const { jsPDF } = window.jspdf;
                    const pdf = new jsPDF({
                        orientation: dimensions.width > dimensions.height ? 'landscape' : 'portrait',
                        unit: 'px',
                        format: [dimensions.width, dimensions.height]
                    });
                    
                    for (let i = 0; i < slides.length; i++) {
                        setExportProgress(Math.round(((i + 1) / slides.length) * 100));
                        
                        const canvas = await renderSlideToCanvas(slides[i], i);
                        if (canvas) {
                            const imgData = canvas.toDataURL('image/png');
                            
                            if (i > 0) {
                                pdf.addPage([dimensions.width, dimensions.height]);
                            }
                            
                            pdf.addImage(imgData, 'PNG', 0, 0, dimensions.width, dimensions.height);
                        }
                    }
                    
                    const safeProjectName = getSafeFileName(projectName);
                    pdf.save(`${safeProjectName}_all_slides.pdf`);
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ PDF:', error);
                    alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ PDF. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
                } finally {
                    setIsExporting(false);
                    setExportProgress(0);
                }
            };

            // –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
            const NewProjectModal = () => {
                if (!showNewProjectModal) return null;
                
                return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                        <div className="bg-white rounded-xl shadow-2xl max-w-md w-full">
                            <div className="p-6">
                                <h2 className="text-2xl font-bold text-gray-800 mb-4">
                                    –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç
                                </h2>
                                
                                <div className="mb-4">
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
                                    </label>
                                    <input
                                        type="text"
                                        value={newProjectName}
                                        onChange={(e) => handleNewProjectNameChange(e.target.value)}
                                        placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ö—É—Ä—Å –ö–ü–¢. –ú–æ–¥—É–ª—å 1. –£—Ä–æ–∫ 1"
                                        className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        autoFocus
                                    />
                                    {newProjectError && (
                                        <p className="mt-2 text-sm text-red-600">
                                            {newProjectError}
                                        </p>
                                    )}
                                </div>
                                
                                <div className="flex gap-3">
                                    <button
                                        onClick={() => setShowNewProjectModal(false)}
                                        className="flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors font-medium"
                                    >
                                        –û—Ç–º–µ–Ω–∞
                                    </button>
                                    <button
                                        onClick={handleConfirmNewProject}
                                        disabled={!newProjectName.trim() || !!newProjectError}
                                        className="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors font-semibold"
                                    >
                                        –î–∞–ª–µ–µ
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            const ConfirmCreateModal = () => {
                if (!showConfirmCreate) return null;
                
                return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                        <div className="bg-white rounded-xl shadow-2xl max-w-md w-full">
                            <div className="p-6">
                                <h2 className="text-2xl font-bold text-gray-800 mb-4">
                                    –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
                                </h2>
                                
                                <p className="text-gray-600 mb-6">
                                    –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç <span className="font-semibold">"{newProjectName}"</span>?
                                </p>
                                
                                <div className="flex gap-3">
                                    <button
                                        onClick={() => setShowConfirmCreate(false)}
                                        className="flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors font-medium"
                                    >
                                        –û—Ç–º–µ–Ω–∞
                                    </button>
                                    <button
                                        onClick={handleFinalCreateProject}
                                        className="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold"
                                    >
                                        –°–æ–∑–¥–∞—Ç—å
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            const ConfirmDeleteModal = () => {
                if (!showConfirmDelete) return null;
                
                return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                        <div className="bg-white rounded-xl shadow-2xl max-w-md w-full">
                            <div className="p-6">
                                <h2 className="text-2xl font-bold text-gray-800 mb-4">
                                    –£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–µ–∫—Ç?
                                </h2>
                                
                                <p className="text-gray-600 mb-6">
                                    –í—ã —É–≤–µ—Ä–µ–Ω—ã? –õ–æ–∫–∞–ª—å–Ω–∞—è —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –ø—Ä–æ–µ–∫—Ç–∞ <span className="font-semibold">"{projectToDelete}"</span> –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–∞ —Å —ç—Ç–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞.
                                </p>
                                
                                <div className="flex gap-3">
                                    <button
                                        onClick={() => setShowConfirmDelete(false)}
                                        className="flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors font-medium"
                                    >
                                        –û—Ç–º–µ–Ω–∞
                                    </button>
                                    <button
                                        onClick={handleConfirmDeleteProject}
                                        className="flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-semibold"
                                    >
                                        –£–¥–∞–ª–∏—Ç—å
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            const ConfirmDeleteSlideModal = () => {
                if (!showConfirmDeleteSlide) return null;
                
                return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                        <div className="bg-white rounded-xl shadow-2xl max-w-md w-full">
                            <div className="p-6">
                                <h2 className="text-2xl font-bold text-red-600 mb-4 flex items-center gap-2">
                                    ‚ö†Ô∏è –£–¥–∞–ª–∏—Ç—å —Å–ª–∞–π–¥?
                                </h2>
                                
                                <p className="text-gray-600 mb-6">
                                    –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å <span className="font-semibold">—Å–ª–∞–π–¥ ‚Ññ{slideToDelete + 1}</span>? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.
                                </p>
                                
                                <div className="flex gap-3">
                                    <button
                                        onClick={() => {
                                            setShowConfirmDeleteSlide(false);
                                            setSlideToDelete(null);
                                        }}
                                        className="flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors font-medium"
                                    >
                                        –û—Ç–º–µ–Ω–∞
                                    </button>
                                    <button
                                        onClick={handleConfirmDeleteSlide}
                                        className="flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-semibold"
                                    >
                                        –£–¥–∞–ª–∏—Ç—å —Å–ª–∞–π–¥
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            const StorageWarningModal = () => {
                if (!showStorageWarning) return null;
                
                return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                        <div className="bg-white rounded-xl shadow-2xl max-w-md w-full">
                            <div className="p-6">
                                <h2 className="text-2xl font-bold text-red-600 mb-4 flex items-center gap-2">
                                    ‚ö†Ô∏è –ü–∞–º—è—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω–∞
                                </h2>
                                
                                <p className="text-gray-600 mb-4">
                                    –ú–µ—Å—Ç–æ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –±—Ä–∞—É–∑–µ—Ä–∞ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è.
                                </p>
                                
                                <p className="text-gray-600 mb-6">
                                    –í–µ—Ä–Ω–∏—Ç–µ—Å—å –∫ —Å–ø–∏—Å–∫—É –ø—Ä–æ–µ–∫—Ç–æ–≤ –∏ —É–¥–∞–ª–∏—Ç–µ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã, —á—Ç–æ–±—ã –æ—Å–≤–æ–±–æ–¥–∏—Ç—å –º–µ—Å—Ç–æ. –ï—Å–ª–∏ —ç—Ç–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –ø—Ä–æ–µ–∫—Ç, —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ç–µ–∫—É—â—É—é —Ä–∞–±–æ—Ç—É –∏ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ –µ—ë –Ω–∞ —á–∞—Å—Ç–∏.
                                </p>
                                
                                <div className="flex gap-3">
                                    <button
                                        onClick={() => setShowStorageWarning(false)}
                                        className="flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors font-medium"
                                    >
                                        –ü–æ–Ω—è—Ç–Ω–æ
                                    </button>
                                    <button
                                        onClick={handleBackToProjects}
                                        className="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold"
                                    >
                                        –ö —Å–ø–∏—Å–∫—É –ø—Ä–æ–µ–∫—Ç–æ–≤
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            const SessionWarningModal = () => {
                if (!showSessionWarning) return null;
                
                return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                        <div className="bg-white rounded-xl shadow-2xl max-w-lg w-full">
                            <div className="p-6">
                                <h2 className="text-2xl font-bold text-orange-600 mb-4 flex items-center gap-2">
                                    ‚ö†Ô∏è –ü—Ä–æ–µ–∫—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç—Å—è –≤ –¥—Ä—É–≥–æ–π –≤–∫–ª–∞–¥–∫–µ
                                </h2>
                                
                                <p className="text-gray-600 mb-4">
                                    –ü—Ä–æ–µ–∫—Ç "<span className="font-semibold">{projectName}</span>" —É–∂–µ –æ—Ç–∫—Ä—ã—Ç –≤ –¥—Ä—É–≥–æ–π –≤–∫–ª–∞–¥–∫–µ –±—Ä–∞—É–∑–µ—Ä–∞. –ò–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –¥–∞–Ω–Ω—ã—Ö.
                                </p>
                                
                                <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                                    <p className="text-sm text-gray-700 font-semibold mb-2">
                                        üí° –ï—Å–ª–∏ –≤—ã –Ω–µ –º–æ–∂–µ—Ç–µ –Ω–∞–π—Ç–∏ –¥—Ä—É–≥—É—é –≤–∫–ª–∞–¥–∫—É –∏–ª–∏ —Å—á–∏—Ç–∞–µ—Ç–µ, —á—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞:
                                    </p>
                                    <ol className="text-sm text-gray-600 space-y-1 list-decimal list-inside ml-2">
                                        <li>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–°–∫–∞—á–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é" –Ω–∏–∂–µ</li>
                                        <li>–ó–∞–∫—Ä–æ–π—Ç–µ —ç—Ç–æ –æ–∫–Ω–æ –∏ —É–¥–∞–ª–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç –∏–∑ —Å–ø–∏—Å–∫–∞</li>
                                        <li>–ù–∞–∂–º–∏—Ç–µ "–ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ–µ–∫—Ç —Å –¥–∏—Å–∫–∞"</li>
                                        <li>–í—ã–±–µ—Ä–∏—Ç–µ —Å–∫–∞—á–∞–Ω–Ω—ã–π —Ñ–∞–π–ª —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏</li>
                                    </ol>
                                </div>
                                
                                <div className="space-y-3">
                                    <button
                                        onClick={() => {
                                            handleExportProjectFromList(projectName);
                                        }}
                                        className="w-full px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-semibold flex items-center justify-center gap-2"
                                    >
                                        üíæ –°–∫–∞—á–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
                                    </button>
                                    
                                    <button
                                        onClick={() => {
                                            setShowSessionWarning(false);
                                            setProjectName('');
                                        }}
                                        className="w-full px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors font-medium"
                                    >
                                        –ó–∞–∫—Ä—ã—Ç—å
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            const InstructionsModal = () => {
                if (!showInstructions) return null;
                
                return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 overflow-y-auto">
                        <div className="bg-white rounded-xl shadow-2xl max-w-3xl w-full my-8">
                            <div className="sticky top-0 bg-white border-b border-gray-200 rounded-t-xl px-6 py-4 flex items-center justify-between">
                                <h2 className="text-2xl font-bold text-gray-800 flex items-center gap-2">
                                    üìñ –ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Å–µ—Ä–≤–∏—Å–æ–º
                                </h2>
                                <button
                                    onClick={() => setShowInstructions(false)}
                                    className="text-gray-400 hover:text-gray-600 text-2xl leading-none"
                                >
                                    ‚úï
                                </button>
                            </div>
                            
                            <div className="p-6 space-y-6 max-h-[70vh] overflow-y-auto">
                                <div className="bg-blue-50 border-l-4 border-blue-500 p-4 rounded">
                                    <p className="text-gray-700 font-semibold mb-2">
                                        üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –î–∏–∑–∞–π–Ω–µ—Ä –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π!
                                    </p>
                                    <p className="text-gray-600 text-sm">
                                        –≠—Ç–æ—Ç —Å–µ—Ä–≤–∏—Å –ø–æ–º–æ–∂–µ—Ç –≤–∞–º –±—ã—Å—Ç—Ä–æ —Å–æ–∑–¥–∞—Ç—å –∫—Ä–∞—Å–∏–≤—ã–µ —Å–ª–∞–π–¥—ã –¥–ª—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π. –°–ª–µ–¥—É–π—Ç–µ –ø—Ä–æ—Å—Ç–æ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –Ω–∏–∂–µ ‚Äî –≤—Å—ë –æ—á–µ–Ω—å –ø—Ä–æ—Å—Ç–æ!
                                    </p>
                                </div>

                                <div className="bg-orange-50 border-l-4 border-orange-500 p-4 rounded">
                                    <p className="text-orange-800 font-bold mb-2 flex items-center gap-2">
                                        ‚ö†Ô∏è –í–∞–∂–Ω–æ! –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–∞–∑–º–µ—Ä –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏
                                    </p>
                                    <div className="text-gray-700 text-sm space-y-2">
                                        <p>
                                            <span className="font-semibold text-green-700">‚úÖ –û–ø—Ç–∏–º–∞–ª—å–Ω–æ: –¥–æ 50 —Å–ª–∞–π–¥–æ–≤</span> ‚Äî –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –±—ã—Å—Ç—Ä–æ –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ
                                        </p>
                                        <p>
                                            <span className="font-semibold text-yellow-700">‚ö†Ô∏è –î–æ–ø—É—Å—Ç–∏–º–æ: 50-80 —Å–ª–∞–π–¥–æ–≤</span> ‚Äî –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –º–µ–¥–ª–µ–Ω–Ω–µ–µ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ
                                        </p>
                                        <p>
                                            <span className="font-semibold text-red-700">‚ùå –ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: –±–æ–ª–µ–µ 80 —Å–ª–∞–π–¥–æ–≤</span> ‚Äî –≤–æ–∑–º–æ–∂–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∏ —ç–∫—Å–ø–æ—Ä—Ç–æ–º, –±—Ä–∞—É–∑–µ—Ä –º–æ–∂–µ—Ç –∑–∞–≤–∏—Å–Ω—É—Ç—å
                                        </p>
                                        <p className="mt-3 bg-white p-2 rounded border border-orange-200">
                                            üí° <span className="font-semibold">–°–æ–≤–µ—Ç:</span> –ï—Å–ª–∏ —É –≤–∞—Å –±–æ–ª—å—à–∞—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è (100+ —Å–ª–∞–π–¥–æ–≤), —Ä–∞–∑–¥–µ–ª–∏—Ç–µ –µ—ë –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —á–∞—Å—Ç–µ–π. –ù–∞–ø—Ä–∏–º–µ—Ä: "–ö—É—Ä—Å –ö–ü–¢ ‚Äî –ß–∞—Å—Ç—å 1", "–ö—É—Ä—Å –ö–ü–¢ ‚Äî –ß–∞—Å—Ç—å 2" –∏ —Ç.–¥.
                                        </p>
                                    </div>
                                </div>

                                <div>
                                    <h3 className="text-xl font-bold text-gray-800 mb-3 flex items-center gap-2">
                                        üéØ –®–∞–≥ 1: –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç
                                    </h3>
                                    <div className="bg-gray-50 p-4 rounded-lg space-y-2 text-gray-700">
                                        <p>‚Ä¢ –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É <span className="font-semibold text-blue-600">"–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç"</span></p>
                                        <p>‚Ä¢ –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≤–∞—à–µ–π –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä: "–£—Ä–æ–∫ –ø–æ –ø—Å–∏—Ö–æ–ª–æ–≥–∏–∏")</p>
                                        <p>‚Ä¢ –ù–∞–∂–º–∏—Ç–µ "–î–∞–ª–µ–µ" –∏ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —Å–æ–∑–¥–∞–Ω–∏–µ</p>
                                        <p className="text-sm text-gray-500 mt-2">üí° –°–æ–≤–µ—Ç: –í—ã–±–∏—Ä–∞–π—Ç–µ –ø–æ–Ω—è—Ç–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ ‚Äî —Ç–∞–∫ –±—É–¥–µ—Ç –ª–µ–≥—á–µ –Ω–∞–π—Ç–∏ –ø—Ä–æ–µ–∫—Ç –ø–æ—Ç–æ–º</p>
                                    </div>
                                </div>

                                <div>
                                    <h3 className="text-xl font-bold text-gray-800 mb-3 flex items-center gap-2">
                                        üìù –®–∞–≥ 2: –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ —Ç–µ–∫—Å—Ç
                                    </h3>
                                    <div className="bg-gray-50 p-4 rounded-lg space-y-2 text-gray-700">
                                        <p>‚Ä¢ –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–µ–∫—Å—Ç –≤–∞—à–µ–π –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏</p>
                                        <p>‚Ä¢ –í—Å—Ç–∞–≤—å—Ç–µ –µ–≥–æ –≤ –±–æ–ª—å—à–æ–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ</p>
                                        <p>‚Ä¢ <span className="font-semibold">–í–∞–∂–Ω–æ!</span> –ö–∞–∂–¥—ã–π —Å–ª–∞–π–¥ –¥–æ–ª–∂–µ–Ω –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å—Å—è –Ω–æ–º–µ—Ä–æ–º –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—Ç—Ä–æ–∫–µ</p>
                                        <p className="text-sm text-gray-600 mt-2">–ü—Ä–∏–º–µ—Ä —Ñ–æ—Ä–º–∞—Ç–∞:</p>
                                        <div className="bg-white p-3 rounded border border-gray-200 font-mono text-sm">
                                            –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø–µ—Ä–≤–æ–≥–æ —Å–ª–∞–π–¥–∞<br/>
                                            –¢–µ–∫—Å—Ç –ø–µ—Ä–≤–æ–≥–æ —Å–ª–∞–π–¥–∞<br/>
                                            1<br/>
                                            <br/>
                                            –ó–∞–≥–æ–ª–æ–≤–æ–∫ –≤—Ç–æ—Ä–æ–≥–æ —Å–ª–∞–π–¥–∞<br/>
                                            –¢–µ–∫—Å—Ç –≤—Ç–æ—Ä–æ–≥–æ —Å–ª–∞–π–¥–∞<br/>
                                            2
                                        </div>
                                        <p>‚Ä¢ –ù–∞–∂–º–∏—Ç–µ <span className="font-semibold text-blue-600">"–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–ª–∞–π–¥—ã"</span></p>
                                    </div>
                                </div>

                                <div>
                                    <h3 className="text-xl font-bold text-gray-800 mb-3 flex items-center gap-2">
                                        üé® –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –¥–∏–∑–∞–π–Ω —Å–ª–∞–π–¥–æ–≤
                                    </h3>
                                    <div className="bg-gray-50 p-4 rounded-lg space-y-3 text-gray-700">
                                        <p className="font-semibold">–¢–µ–ø–µ—Ä—å —Å–∞–º–æ–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ ‚Äî –¥–µ–ª–∞–µ–º —Å–ª–∞–π–¥—ã –∫—Ä–∞—Å–∏–≤—ã–º–∏!</p>
                                        
                                        <div className="ml-4 space-y-2">
                                            <p><span className="font-semibold">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ç–µ–∫—Å—Ç—ã:</span> –í –ª–µ–≤–æ–π —á–∞—Å—Ç–∏ –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫, –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç, –∞–∫—Ü–µ–Ω—Ç–Ω—ã–π —Ç–µ–∫—Å—Ç</p>
                                            <p><span className="font-semibold">üìè –ú–µ–Ω—è–π—Ç–µ —Ä–∞–∑–º–µ—Ä—ã —à—Ä–∏—Ñ—Ç–æ–≤:</span> –î–≤–∏–≥–∞–π—Ç–µ –ø–æ–ª–∑—É–Ω–∫–∏, —á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å —Ç–µ–∫—Å—Ç –±–æ–ª—å—à–µ –∏–ª–∏ –º–µ–Ω—å—à–µ</p>
                                            <p><span className="font-semibold">üé® –í—ã–±–∏—Ä–∞–π—Ç–µ —Ü–≤–µ—Ç–∞:</span> –ò–∑–º–µ–Ω–∏—Ç–µ —Ü–≤–µ—Ç —Ñ–æ–Ω–∞ (–æ–¥–Ω–æ—Ç–æ–Ω–Ω—ã–π –∏–ª–∏ –≥—Ä–∞–¥–∏–µ–Ω—Ç), —Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞, —Ü–≤–µ—Ç –≤—ã–¥–µ–ª–µ–Ω–∏—è</p>
                                            <p><span className="font-semibold">üñºÔ∏è –î–æ–±–∞–≤—å—Ç–µ –∫–∞—Ä—Ç–∏–Ω–∫—É:</span> –ú–æ–∂–µ—Ç–µ –ø–æ—Å—Ç–∞–≤–∏—Ç—å —Å–≤–æ—ë –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–∞–∫ —Ñ–æ–Ω —Å–ª–∞–π–¥–∞</p>
                                            <p><span className="font-semibold">üî§ –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ:</span> –¢–µ–∫—Å—Ç –º–æ–∂–Ω–æ –≤—ã—Ä–æ–≤–Ω—è—Ç—å –ø–æ –ª–µ–≤–æ–º—É –∫—Ä–∞—é –∏–ª–∏ –ø–æ —Ü–µ–Ω—Ç—Ä—É</p>
                                        </div>
                                        
                                        <div className="bg-yellow-50 border border-yellow-200 p-3 rounded mt-3">
                                            <p className="text-sm font-semibold text-yellow-800 mb-1">‚ö° –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π:</p>
                                            <p className="text-sm text-yellow-700">–ö–æ–≥–¥–∞ –º–µ–Ω—è–µ—Ç–µ —Ü–≤–µ—Ç–∞ –∏–ª–∏ —Ä–∞–∑–º–µ—Ä—ã, –ø–æ—è–≤–∏—Ç—Å—è –æ–∫–æ—à–∫–æ: "–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ –∫ —ç—Ç–æ–º—É —Å–ª–∞–π–¥—É" –∏–ª–∏ "–ü—Ä–∏–º–µ–Ω–∏—Ç—å –∫ —ç—Ç–æ–º—É –∏ —Å–ª–µ–¥—É—é—â–∏–º". –í—ã–±–∏—Ä–∞–π—Ç–µ –Ω—É–∂–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç!</p>
                                        </div>
                                    </div>
                                </div>

                                <div>
                                    <h3 className="text-xl font-bold text-gray-800 mb-3 flex items-center gap-2">
                                        üíæ –®–∞–≥ 4: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ —ç–∫—Å–ø–æ—Ä—Ç
                                    </h3>
                                    <div className="bg-gray-50 p-4 rounded-lg space-y-3 text-gray-700">
                                        <p className="font-semibold">–í–∞—à–∞ —Ä–∞–±–æ—Ç–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!</p>
                                        
                                        <div className="ml-4 space-y-2">
                                            <p>üì± <span className="font-semibold">–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ:</span> –ö–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ –Ω–∞ —ç—Ç–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ. –ú–∞–ª–µ–Ω—å–∫–∞—è –∏–∫–æ–Ω–∫–∞ –¥–∏—Å–∫–µ—Ç—ã üíæ –ø–æ—è–≤–∏—Ç—Å—è –≤–Ω–∏–∑—É —Å–ª–µ–≤–∞</p>
                                            <p>üíª <span className="font-semibold">–•—Ä–∞–Ω–µ–Ω–∏–µ:</span> –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ –≤–∞—à–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ/—Ç–µ–ª–µ—Ñ–æ–Ω–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ. –ù–∏–∫—É–¥–∞ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –æ–Ω–∏ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è</p>
                                        </div>

                                        <div className="bg-green-50 border border-green-200 p-3 rounded">
                                            <p className="font-semibold text-green-800 mb-2">‚úÖ –ö–∞–∫ —Å–∫–∞—á–∞—Ç—å –≥–æ—Ç–æ–≤—ã–µ —Å–ª–∞–π–¥—ã:</p>
                                            <div className="text-sm text-green-700 space-y-1 ml-2">
                                                <p>‚Ä¢ <span className="font-semibold">"–°–∫–∞—á–∞—Ç—å —Ç–µ–∫—É—â–∏–π —Å–ª–∞–π–¥"</span> ‚Äî —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –∫–∞—Ä—Ç–∏–Ω–∫–∞ –æ–¥–Ω–æ–≥–æ —Å–ª–∞–π–¥–∞</p>
                                                <p>‚Ä¢ <span className="font-semibold">"–°–∫–∞—á–∞—Ç—å –≤—Å–µ —Å–ª–∞–π–¥—ã ZIP"</span> ‚Äî –≤—Å–µ —Å–ª–∞–π–¥—ã –≤ –∞—Ä—Ö–∏–≤–µ (–æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏)</p>
                                                <p>‚Ä¢ <span className="font-semibold">"–°–∫–∞—á–∞—Ç—å –≤—Å–µ —Å–ª–∞–π–¥—ã PDF"</span> ‚Äî –æ–¥–∏–Ω —Ñ–∞–π–ª PDF —Å–æ –≤—Å–µ–º–∏ —Å–ª–∞–π–¥–∞–º–∏</p>
                                                <p>‚Ä¢ <span className="font-semibold">"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–µ–∫—Ç –Ω–∞ –¥–∏—Å–∫"</span> ‚Äî —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —Å–æ –≤—Å–µ–º–∏ —Ç–µ–∫—Å—Ç–∞–º–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div>
                                    <h3 className="text-xl font-bold text-gray-800 mb-3 flex items-center gap-2">
                                        ‚ö†Ô∏è –í–∞–∂–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
                                    </h3>
                                    <div className="bg-red-50 p-4 rounded-lg space-y-3 text-gray-700">
                                        <div>
                                            <p className="font-semibold text-red-700 mb-2">üñºÔ∏è –§–æ–Ω–æ–≤—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</p>
                                            <p className="text-sm">–ß—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–ø–æ–ª–Ω—è—Ç—å –ø–∞–º—è—Ç—å –±—Ä–∞—É–∑–µ—Ä–∞, –∫–∞—Ä—Ç–∏–Ω–∫–∏ —Ñ–æ–Ω–∞ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏. –ï—Å–ª–∏ –∑–∞–∫—Ä–æ–µ—Ç–µ –±—Ä–∞—É–∑–µ—Ä, –∏—Ö –ø—Ä–∏–¥—ë—Ç—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –∑–∞–Ω–æ–≤–æ. –ó–∞—Ç–æ —Ç–µ–∫—Å—Ç—ã –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∏–∫—É–¥–∞ –Ω–µ –¥–µ–Ω—É—Ç—Å—è!</p>
                                        </div>
                                        
                                        <div>
                                            <p className="font-semibold text-orange-700 mb-2">üíæ –ü–∞–º—è—Ç—å –±—Ä–∞—É–∑–µ—Ä–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∞</p>
                                            <p className="text-sm">–ï—Å–ª–∏ –ø–∞–º—è—Ç—å –∑–∞–ø–æ–ª–Ω–∏—Ç—Å—è, –≤—ã —É–≤–∏–¥–∏—Ç–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ. –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ:</p>
                                            <div className="ml-4 mt-2 text-sm space-y-1">
                                                <p>1. –°–∫–∞—á–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –Ω—É–∂–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ (–∫–Ω–æ–ø–∫–∞ üíæ —Ä—è–¥–æ–º —Å –ø—Ä–æ–µ–∫—Ç–æ–º)</p>
                                                <p>2. –£–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä—ã–µ/–∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã –∏–∑ —Å–ø–∏—Å–∫–∞</p>
                                                <p>3. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –Ω—É–∂–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –æ–±—Ä–∞—Ç–Ω–æ —á–µ—Ä–µ–∑ "–ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ–µ–∫—Ç —Å –¥–∏—Å–∫–∞"</p>
                                            </div>
                                        </div>

                                        <div>
                                            <p className="font-semibold text-purple-700 mb-2">üö´ –ù–µ –æ—Ç–∫—Ä—ã–≤–∞–π—Ç–µ –æ–¥–∏–Ω –ø—Ä–æ–µ–∫—Ç –≤ –¥–≤—É—Ö –≤–∫–ª–∞–¥–∫–∞—Ö</p>
                                            <p className="text-sm">–ï—Å–ª–∏ –ø–æ–ø—Ä–æ–±—É–µ—Ç–µ –æ—Ç–∫—Ä—ã—Ç—å –ø—Ä–æ–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π —É–∂–µ –æ—Ç–∫—Ä—ã—Ç –≤ –¥—Ä—É–≥–æ–π –≤–∫–ª–∞–¥–∫–µ, —É–≤–∏–¥–∏—Ç–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ. –ó–∞–∫—Ä–æ–π—Ç–µ –¥—Ä—É–≥—É—é –≤–∫–ª–∞–¥–∫—É –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é.</p>
                                        </div>
                                    </div>
                                </div>

                                <div>
                                    <h3 className="text-xl font-bold text-gray-800 mb-3 flex items-center gap-2">
                                        üé¨ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
                                    </h3>
                                    <div className="bg-gray-50 p-4 rounded-lg space-y-2 text-gray-700 text-sm">
                                        <p>‚Ä¢ <span className="font-semibold">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å–ª–∞–π–¥</span> ‚Äî —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–π –ø—É—Å—Ç–æ–π —Å–ª–∞–π–¥ –ø–æ—Å–ª–µ —Ç–µ–∫—É—â–µ–≥–æ</p>
                                        <p>‚Ä¢ <span className="font-semibold">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å —Å–ª–∞–π–¥</span> ‚Äî —É–¥–∞–ª—è–µ—Ç —Ç–µ–∫—É—â–∏–π —Å–ª–∞–π–¥ (—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º)</p>
                                        <p>‚Ä¢ <span className="font-semibold">–§–æ—Ä–º–∞—Ç —Å–ª–∞–π–¥–∞</span> ‚Äî –Ω–∞ –ø–µ—Ä–≤–æ–º —Å–ª–∞–π–¥–µ –º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å: 16:9, 4:3 –∏–ª–∏ –∫–≤–∞–¥—Ä–∞—Ç 1:1</p>
                                        <p>‚Ä¢ <span className="font-semibold">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</span> ‚Äî —Å–ø—Ä–∞–≤–∞ –≤—Å–µ–≥–¥–∞ –≤–∏–¥–Ω–æ, –∫–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç —Å–ª–∞–π–¥</p>
                                        <p>‚Ä¢ <span className="font-semibold">–ö–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏</span> ‚Äî "–ü—Ä–µ–¥—ã–¥—É—â–∏–π" / "–°–ª–µ–¥—É—é—â–∏–π" –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É —Å–ª–∞–π–¥–∞–º–∏</p>
                                    </div>
                                </div>

                                <div className="bg-gradient-to-r from-blue-50 to-purple-50 border-2 border-blue-200 p-4 rounded-lg">
                                    <p className="font-bold text-gray-800 text-center text-lg mb-2">üéâ –í—Å—ë –≥–æ—Ç–æ–≤–æ!</p>
                                    <p className="text-gray-600 text-center text-sm">
                                        –¢–µ–ø–µ—Ä—å –≤—ã –∑–Ω–∞–µ—Ç–µ –≤—Å—ë, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫—Ä–∞—Å–∏–≤—ã–µ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏. –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ ‚Äî –≤—Å–µ–≥–¥–∞ –º–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å —ç—Ç—É –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é —Å–Ω–æ–≤–∞!
                                    </p>
                                </div>
                            </div>

                            <div className="sticky bottom-0 bg-white border-t border-gray-200 rounded-b-xl px-6 py-4">
                                <button
                                    onClick={() => setShowInstructions(false)}
                                    className="w-full px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold"
                                >
                                    –ü–æ–Ω—è—Ç–Ω–æ, –∑–∞–∫—Ä—ã—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é
                                </button>
                            </div>
                        </div>
                    </div>
                );
            };

            const ImageApplyModal = () => {
                if (!showImageModal) return null;
                
                return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                        <div className="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                            <div className="p-6">
                                <h2 className="text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                                    üñºÔ∏è –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–æ–Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                                </h2>
                                
                                <div className="mb-6">
                                    <p className="text-gray-600 mb-4">
                                        –í—ã–±–µ—Ä–∏—Ç–µ, –∫–∞–∫ –ø—Ä–∏–º–µ–Ω–∏—Ç—å —ç—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ:
                                    </p>
                                    
                                    {pendingImage && (
                                        <div className="mb-4 rounded-lg overflow-hidden border-2 border-gray-300 bg-gray-100 p-4">
                                            <div className="flex justify-center items-center">
                                                <img 
                                                    src={pendingImage} 
                                                    alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ñ–æ–Ω–æ–≤–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è" 
                                                    className="max-w-full max-h-[400px] object-contain rounded"
                                                    style={{ display: 'block' }}
                                                />
                                            </div>
                                            <p className="text-sm text-gray-500 text-center mt-2">
                                                –ü—Ä–µ–≤—å—é: —Ç–∞–∫ –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ —Å–ª–∞–π–¥–µ
                                            </p>
                                        </div>
                                    )}
                                </div>
                                
                                <div className="space-y-3">
                                    <button
                                        onClick={applyImageToCurrentSlide}
                                        className="w-full px-6 py-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all font-semibold shadow-md hover:shadow-lg transform hover:scale-105 flex items-center justify-center gap-2"
                                    >
                                        <span>üìÑ</span>
                                        –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ –¥–ª—è —ç—Ç–æ–≥–æ —Å–ª–∞–π–¥–∞ ({currentSlideIndex + 1})
                                    </button>
                                    
                                    <button
                                        onClick={applyImageToFollowingSlides}
                                        className="w-full px-6 py-4 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-all font-semibold shadow-md hover:shadow-lg transform hover:scale-105 flex items-center justify-center gap-2"
                                    >
                                        <span>‚û°Ô∏è</span>
                                        –ü—Ä–∏–º–µ–Ω–∏—Ç—å –¥–ª—è —ç—Ç–æ–≥–æ –∏ —Å–ª–µ–¥—É—é—â–∏—Ö
                                    </button>
                                    
                                    <button
                                        onClick={cancelImageUpload}
                                        className="w-full px-6 py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors font-medium border border-gray-300"
                                    >
                                        ‚ùå –û—Ç–º–µ–Ω–∏—Ç—å
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            const ImageDeleteModal = () => {
                if (!showDeleteModal) return null;
                
                return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                        <div className="bg-white rounded-xl shadow-2xl max-w-md w-full">
                            <div className="p-6">
                                <h2 className="text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                                    üóëÔ∏è –£–¥–∞–ª–∏—Ç—å —Ñ–æ–Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                                </h2>
                                
                                <p className="text-gray-600 mb-6">
                                    –í—ã–±–µ—Ä–∏—Ç–µ –æ–±–ª–∞—Å—Ç—å —É–¥–∞–ª–µ–Ω–∏—è:
                                </p>
                                
                                <div className="space-y-3">
                                    <button
                                        onClick={() => {
                                            removeBackgroundImage('current');
                                            setShowDeleteModal(false);
                                        }}
                                        className="w-full px-6 py-3 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition-all font-semibold border-2 border-red-200 flex items-center justify-center gap-2"
                                    >
                                        <span>üìÑ</span>
                                        –£–¥–∞–ª–∏—Ç—å —Ç–æ–ª—å–∫–æ –Ω–∞ —ç—Ç–æ–º —Å–ª–∞–π–¥–µ
                                    </button>
                                    
                                    <button
                                        onClick={() => {
                                            removeBackgroundImage('following');
                                            setShowDeleteModal(false);
                                        }}
                                        className="w-full px-6 py-3 bg-orange-50 text-orange-700 rounded-lg hover:bg-orange-100 transition-all font-semibold border-2 border-orange-200 flex items-center justify-center gap-2"
                                    >
                                        <span>‚û°Ô∏è</span>
                                        –£–¥–∞–ª–∏—Ç—å –Ω–∞ —ç—Ç–æ–º –∏ —Å–ª–µ–¥—É—é—â–∏—Ö
                                    </button>
                                    
                                    <button
                                        onClick={() => {
                                            removeBackgroundImage('all');
                                            setShowDeleteModal(false);
                                        }}
                                        className="w-full px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-all font-semibold shadow-md hover:shadow-lg flex items-center justify-center gap-2"
                                    >
                                        <span>üóëÔ∏è</span>
                                        –£–¥–∞–ª–∏—Ç—å —Å–æ –≤—Å–µ—Ö —Å–ª–∞–π–¥–æ–≤
                                    </button>
                                    
                                    <button
                                        onClick={() => setShowDeleteModal(false)}
                                        className="w-full px-6 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors font-medium border border-gray-300"
                                    >
                                        –û—Ç–º–µ–Ω–∞
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            const ExportProgressModal = () => {
                if (!isExporting) return null;
                
                return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                        <div className="bg-white rounded-xl shadow-2xl p-8 max-w-md w-full mx-4">
                            <h3 className="text-xl font-bold text-gray-800 mb-4 text-center">
                                ‚è≥ –≠–∫—Å–ø–æ—Ä—Ç —Å–ª–∞–π–¥–æ–≤...
                            </h3>
                            <div className="mb-4">
                                <div className="w-full bg-gray-200 rounded-full h-4 overflow-hidden">
                                    <div 
                                        className="bg-blue-600 h-full transition-all duration-300 ease-out"
                                        style={{ width: `${exportProgress}%` }}
                                    />
                                </div>
                            </div>
                            <p className="text-center text-gray-600 font-semibold">
                                {exportProgress}%
                            </p>
                            <p className="text-center text-sm text-gray-500 mt-2">
                                –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ...
                            </p>
                        </div>
                    </div>
                );
            };

            const AutoSaveIndicator = () => {
                if (mode !== 'edit' || !isSaving) return null;
                
                return (
                    <div className="fixed bottom-4 left-4 bg-white rounded-full shadow-lg p-2 border border-gray-200 animate-fade-in-out">
                        <span className="text-xl">üíæ</span>
                    </div>
                );
            };

            // –≠–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
            if (mode === 'projectSelect') {
                const displayedProjects = showAllProjects ? allProjects : allProjects.slice(0, 10);
                
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
                        <NewProjectModal />
                        <ConfirmCreateModal />
                        <ConfirmDeleteModal />
                        <SessionWarningModal />
                        <InstructionsModal />
                        
                        <div className="max-w-4xl mx-auto py-8">
                            <div className="bg-white rounded-xl shadow-lg p-8 mb-6">
                                <div className="flex items-start justify-between mb-2">
                                    <h1 className="text-3xl font-bold text-gray-800 flex items-center gap-2">
                                        üìä –î–∏–∑–∞–π–Ω–µ—Ä –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π
                                    </h1>
                                    <button
                                        onClick={() => setShowInstructions(true)}
                                        className="px-6 py-3 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors text-base font-semibold border-2 border-blue-300 flex items-center gap-2 shadow-md"
                                    >
                                        üìñ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
                                    </button>
                                </div>
                                <p className="text-gray-600 mb-6">
                                    –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π
                                </p>
                                
                                <button
                                    onClick={handleCreateNewProject}
                                    className="w-full bg-blue-600 text-white py-4 px-6 rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center gap-2 font-semibold text-lg shadow-md hover:shadow-lg mb-3"
                                >
                                    ‚ûï –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç
                                </button>
                                
                                <div className="relative">
                                    <input
                                        ref={importProjectFileRef}
                                        type="file"
                                        accept=".json"
                                        onChange={handleImportProjectFile}
                                        className="hidden"
                                    />
                                    <button
                                        onClick={() => importProjectFileRef.current?.click()}
                                        className="w-full bg-gray-100 text-gray-700 py-4 px-6 rounded-lg hover:bg-gray-200 transition-colors flex items-center justify-center gap-2 font-semibold text-lg border-2 border-gray-300"
                                    >
                                        üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ–µ–∫—Ç —Å –¥–∏—Å–∫–∞
                                    </button>
                                </div>
                            </div>
                            
                            {allProjects.length > 0 && (
                                <div className="bg-white rounded-xl shadow-lg p-8">
                                    <h2 className="text-xl font-bold text-gray-800 mb-4">
                                        –ú–æ–∏ –ø—Ä–æ–µ–∫—Ç—ã
                                    </h2>
                                    <p className="text-sm text-gray-500 mb-6">
                                        –†–∞–±–æ—Ç–∞, —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–∞—è –Ω–∞ —ç—Ç–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ. –í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã.
                                    </p>
                                    
                                    <div className="space-y-3">
                                        {displayedProjects.map((project, index) => (
                                            <div
                                                key={index}
                                                className="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow"
                                            >
                                                <div className="flex items-start justify-between mb-3">
                                                    <div className="flex-1">
                                                        <h3 className="font-semibold text-gray-800 mb-1 flex items-center gap-2">
                                                            üìÅ {project.name}
                                                        </h3>
                                                        <p className="text-sm text-gray-500">
                                                            –ü–æ—Å–ª–µ–¥–Ω–µ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ: {ProjectUtils.formatDate(project.lastModified)}
                                                        </p>
                                                        <p className="text-sm text-gray-500">
                                                            –°–ª–∞–π–¥–æ–≤: {project.slideCount}
                                                        </p>
                                                    </div>
                                                </div>
                                                <div className="flex gap-2">
                                                    <button
                                                        onClick={() => handleContinueProject(project.name)}
                                                        className="flex-1 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors text-sm font-medium"
                                                    >
                                                        –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å
                                                    </button>
                                                    <button
                                                        onClick={() => handleExportProjectFromList(project.name)}
                                                        className="px-4 py-2 bg-gray-100 text-gray-600 rounded-md hover:bg-gray-200 transition-colors text-sm font-medium border border-gray-300"
                                                        title="–°–∫–∞—á–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é"
                                                    >
                                                        üíæ
                                                    </button>
                                                    <button
                                                        onClick={() => handleDeleteProject(project.name)}
                                                        className="px-4 py-2 bg-red-50 text-red-600 rounded-md hover:bg-red-100 transition-colors text-sm font-medium border border-red-200"
                                                    >
                                                        –£–¥–∞–ª–∏—Ç—å
                                                    </button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                    
                                    {allProjects.length > 10 && !showAllProjects && (
                                        <button
                                            onClick={() => setShowAllProjects(true)}
                                            className="w-full mt-4 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors font-medium"
                                        >
                                            –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –ø—Ä–æ–µ–∫—Ç—ã ({allProjects.length})
                                        </button>
                                    )}
                                    
                                    {showAllProjects && allProjects.length > 10 && (
                                        <button
                                            onClick={() => setShowAllProjects(false)}
                                            className="w-full mt-4 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors font-medium"
                                        >
                                            –ü–æ–∫–∞–∑–∞—Ç—å –º–µ–Ω—å—à–µ
                                        </button>
                                    )}
                                </div>
                            )}
                        </div>
                    </div>
                );
            }

            // –≠–∫—Ä–∞–Ω –∏–º–ø–æ—Ä—Ç–∞
            if (mode === 'import') {
                return (
                    <div className="min-h-screen bg-gray-50 p-4">
                        <InstructionsModal />
                        <div className="max-w-4xl mx-auto">
                            <div className="bg-white rounded-xl shadow-lg p-8">
                                <div className="flex justify-between items-center mb-6">
                                    <div>
                                        <h1 className="text-3xl font-bold text-gray-800 mb-2 flex items-center gap-2">
                                            üìÑ –ò–º–ø–æ—Ä—Ç —Å–ª–∞–π–¥–æ–≤
                                        </h1>
                                        <p className="text-sm text-gray-500">
                                            –ü—Ä–æ–µ–∫—Ç: <span className="font-semibold">{projectName}</span>
                                        </p>
                                    </div>
                                    <button
                                        onClick={handleBackToProjects}
                                        className="px-4 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition-colors flex items-center gap-2"
                                    >
                                        ‚Üê –ù–∞–∑–∞–¥ –∫ –ø—Ä–æ–µ–∫—Ç–∞–º
                                    </button>
                                </div>
                                
                                <p className="text-gray-600 mb-6">
                                    –í—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–æ—Ä–º–∞—Ç "–°–ª–∞–π–¥ 1", "–°–ª–∞–π–¥ 2" –∏ —Ç.–¥. –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è —Å–ª–∞–π–¥–æ–≤.
                                </p>
                                
                                <div className="mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                                    <div className="flex items-start gap-3">
                                        <div className="text-blue-600 text-xl mt-1">‚ÑπÔ∏è</div>
                                        <div>
                                            <h3 className="font-semibold text-blue-900 mb-2">–§–æ—Ä–º–∞—Ç —Ç–µ–∫—Å—Ç–∞:</h3>
                                            <p className="text-blue-800 text-sm mb-2">
                                                –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–æ—Ä–º–∞—Ç "–°–ª–∞–π–¥ 1", "–°–ª–∞–π–¥ 2" –∏ —Ç.–¥. –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è —Å–ª–∞–π–¥–æ–≤.
                                            </p>
                                            <p className="text-blue-800 text-sm mb-2">
                                                –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –≤–∞—Ä–∏–∞–Ω—Ç—ã:
                                            </p>
                                            <ul className="text-blue-800 text-sm list-disc list-inside ml-2 space-y-1">
                                                <li><strong>–°–ª–∞–π–¥ 1</strong> (—Å –ø—Ä–æ–±–µ–ª–æ–º)</li>
                                                <li><strong>–°–ª–∞–π–¥1</strong> (–±–µ–∑ –ø—Ä–æ–±–µ–ª–∞)</li>
                                                <li><strong>–°–ª–∞–π–¥ 1 –ó–∞–≥–æ–ª–æ–≤–æ–∫</strong> (–∑–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–∞ —Ç–æ–π –∂–µ —Å—Ç—Ä–æ–∫–µ)</li>
                                                <li>–õ—é–±–æ–π —Ä–µ–≥–∏—Å—Ç—Ä: <strong>—Å–ª–∞–π–¥ 1</strong>, <strong>–°–õ–ê–ô–î 1</strong></li>
                                            </ul>
                                            <p className="text-blue-800 text-sm mt-2">
                                                –í–µ—Å—å —Ç–µ–∫—Å—Ç –ø–æ—Å–ª–µ –Ω–æ–º–µ—Ä–∞ —Å–ª–∞–π–¥–∞ –∏ –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ –Ω–æ–º–µ—Ä–∞ –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º—ã–º —ç—Ç–æ–≥–æ —Å–ª–∞–π–¥–∞.
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div className="mb-6">
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        –¢–µ–∫—Å—Ç –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏
                                    </label>
                                    <textarea
                                        ref={importTextRef}
                                        className="w-full h-96 px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent font-mono text-sm"
                                        placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞...&#10;&#10;–ü—Ä–∏–º–µ—Ä:&#10;&#10;–°–ª–∞–π–¥ 1&#10;–ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø–µ—Ä–≤–æ–≥–æ —Å–ª–∞–π–¥–∞&#10;–û—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç –ø–µ—Ä–≤–æ–≥–æ —Å–ª–∞–π–¥–∞&#10;&#10;–°–ª–∞–π–¥ 2&#10;–ó–∞–≥–æ–ª–æ–≤–æ–∫ –≤—Ç–æ—Ä–æ–≥–æ —Å–ª–∞–π–¥–∞&#10;–¢–µ–∫—Å—Ç –≤—Ç–æ—Ä–æ–≥–æ —Å–ª–∞–π–¥–∞&#10;&#10;–ò–ª–∏ —Ç–∞–∫:&#10;&#10;–°–ª–∞–π–¥ 1 –ó–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–∞ —Ç–æ–π –∂–µ —Å—Ç—Ä–æ–∫–µ&#10;–û—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç&#10;–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç&#10;&#10;–°–ª–∞–π–¥ 2 –ï—â–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫&#10;–ï—â–µ —Ç–µ–∫—Å—Ç"
                                    />
                                </div>
                                
                                <button
                                    onClick={handleImport}
                                    className="w-full bg-blue-600 text-white py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center gap-2 font-semibold text-lg shadow-md hover:shadow-lg"
                                >
                                    ‚¨ÜÔ∏è –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–ª–∞–π–¥—ã
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            // –≠–∫—Ä–∞–Ω —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            return (
                <div className="min-h-screen bg-gray-50 p-4">
                    <ImageApplyModal />
                    <ImageDeleteModal />
                    <ExportProgressModal />
                    <StorageWarningModal />
                    <SessionWarningModal />
                    <ConfirmDeleteSlideModal />
                    <InstructionsModal />
                    <AutoSaveIndicator />
                    
                    <div className="max-w-7xl mx-auto">
                        <div className="bg-white rounded-xl shadow-lg p-6 mb-6">
                            <div className="flex justify-between items-center mb-4">
                                <div>
                                    <h1 className="text-2xl font-bold text-gray-800 flex items-center gap-2">
                                        üìä {projectName}
                                    </h1>
                                    <p className="text-sm text-gray-500">
                                        {slides.length} —Å–ª–∞–π–¥–æ–≤
                                    </p>
                                </div>
                                
                                <div className="flex items-center gap-3">
                                    <button
                                        onClick={() => setShowInstructions(true)}
                                        className="px-4 py-2 bg-yellow-50 text-yellow-700 rounded-lg hover:bg-yellow-100 transition-colors text-sm font-medium border-2 border-yellow-300 flex items-center gap-2"
                                    >
                                        ‚ùì –ß—Ç–æ-—Ç–æ –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ? –ß–∏—Ç–∞–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é
                                    </button>
                                    
                                    <button
                                        onClick={handleBackToProjects}
                                        className="px-4 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition-colors flex items-center gap-2"
                                    >
                                        ‚Üê –ù–∞–∑–∞–¥ –∫ –ø—Ä–æ–µ–∫—Ç–∞–º
                                    </button>
                                </div>
                            </div>
                            
                            <div className="mb-6 bg-gray-50 p-4 rounded-lg">
                                <div className="flex items-center justify-between mb-3">
                                    <button
                                        onClick={() => setCurrentSlideIndex(Math.max(0, currentSlideIndex - 1))}
                                        disabled={currentSlideIndex === 0}
                                        className="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors flex items-center gap-2"
                                    >
                                        ‚óÄ –ü—Ä–µ–¥—ã–¥—É—â–∏–π
                                    </button>
                                    
                                    <div className="flex flex-col items-center gap-2">
                                        <span className="text-lg font-semibold text-gray-700">
                                            –°–ª–∞–π–¥ {currentSlideIndex + 1} –∏–∑ {slides.length}
                                        </span>
                                        
                                        <div className="flex gap-2">
                                            <button
                                                onClick={handleDeleteSlideRequest}
                                                disabled={slides.length <= 1}
                                                className="px-4 py-2 bg-gray-100 text-gray-600 rounded-md hover:bg-gray-200 disabled:bg-gray-50 disabled:text-gray-400 disabled:cursor-not-allowed transition-colors flex items-center gap-1 text-sm"
                                            >
                                                üóëÔ∏è –£–¥–∞–ª–∏—Ç—å —Å–ª–∞–π–¥
                                            </button>
                                            
                                            <button
                                                onClick={createNewSlide}
                                                className="px-4 py-2 bg-gray-100 text-gray-600 rounded-md hover:bg-gray-200 transition-colors flex items-center gap-1 text-sm"
                                            >
                                                ‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å–ª–∞–π–¥
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <button
                                        onClick={() => setCurrentSlideIndex(Math.min(slides.length - 1, currentSlideIndex + 1))}
                                        disabled={currentSlideIndex === slides.length - 1}
                                        className="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors flex items-center gap-2"
                                    >
                                        –°–ª–µ–¥—É—é—â–∏–π ‚ñ∂
                                    </button>
                                </div>
                                
                                <div className="flex gap-2 overflow-x-auto pb-2">
                                    {slides.map((slide, index) => (
                                        <button
                                            key={index}
                                            onClick={() => setCurrentSlideIndex(index)}
                                            className={`flex-shrink-0 px-3 py-2 rounded-md text-sm font-medium transition-colors ${
                                                index === currentSlideIndex
                                                    ? 'bg-blue-600 text-white'
                                                    : 'bg-white text-gray-700 hover:bg-gray-100'
                                            }`}
                                        >
                                            {index + 1}
                                        </button>
                                    ))}
                                </div>
                            </div>
                            
                            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <div className="space-y-4">
                                    {currentSlideIndex === 0 && (
                                        <div className="bg-gradient-to-r from-purple-50 to-blue-50 p-4 rounded-lg border border-purple-200">
                                            <h3 className="font-semibold text-gray-700 mb-3">
                                                –§–æ—Ä–º–∞—Ç —Å–ª–∞–π–¥–æ–≤ (–¥–ª—è –≤—Å–µ–π –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏)
                                            </h3>
                                            
                                            <div className="space-y-3">
                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                                        –§–æ—Ä–º–∞—Ç —Å–ª–∞–π–¥–∞
                                                    </label>
                                                    <select
                                                        value={aspectRatio}
                                                        onChange={(e) => setAspectRatio(e.target.value)}
                                                        className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 bg-white"
                                                    >
                                                        <option value="16:9">16:9 (–®–∏—Ä–æ–∫–æ—Ñ–æ—Ä–º–∞—Ç–Ω—ã–π)</option>
                                                        <option value="1:1">1:1 (–ö–≤–∞–¥—Ä–∞—Ç–Ω—ã–π)</option>
                                                        <option value="4:3">4:3 (–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π)</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    )}

                                    <div className="bg-gray-50 p-4 rounded-lg">
                                        <h3 className="font-semibold text-gray-700 mb-3 flex items-center gap-2">
                                            ‚úçÔ∏è –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–ª–∞–π–¥–∞ {currentSlideIndex + 1}
                                        </h3>
                                        
                                        <div className="space-y-3">
                                            <div>
                                                <div className="flex justify-between items-center mb-1">
                                                    <label className="block text-sm font-medium text-gray-600">
                                                        –ó–∞–≥–æ–ª–æ–≤–æ–∫
                                                    </label>
                                                    <AlignmentToggle 
                                                        value={currentSlide.titleAlign} 
                                                        onChange={(value) => updateCurrentSlide('titleAlign', value)} 
                                                    />
                                                </div>
                                                <textarea
                                                    value={currentSlide.title || ''}
                                                    onChange={(e) => updateCurrentSlide('title', e.target.value)}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                    rows="3"
                                                    placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫"
                                                />
                                            </div>
                                            
                                            <div>
                                                <div className="flex justify-between items-center mb-1">
                                                    <label className="block text-sm font-medium text-gray-600">
                                                        –û—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç
                                                    </label>
                                                    <div className="flex gap-2">
                                                        <TextFormattingToolbar 
                                                            textareaRef={mainTextRef}
                                                            onTextChange={(newText) => updateCurrentSlide('mainText', newText)}
                                                        />
                                                        <AlignmentToggle 
                                                            value={currentSlide.mainTextAlign} 
                                                            onChange={(value) => updateCurrentSlide('mainTextAlign', value)} 
                                                        />
                                                    </div>
                                                </div>
                                                <textarea
                                                    ref={mainTextRef}
                                                    value={currentSlide.mainText || ''}
                                                    onChange={(e) => updateCurrentSlide('mainText', e.target.value)}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                    rows="7"
                                                    placeholder="–í–≤–µ–¥–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç"
                                                />
                                            </div>
                                            
                                            <div>
                                                <div className="flex justify-between items-center mb-1">
                                                    <label className="block text-sm font-medium text-gray-600">
                                                        –ê–∫—Ü–µ–Ω—Ç–Ω—ã–π —Ç–µ–∫—Å—Ç
                                                    </label>
                                                    <div className="flex gap-2">
                                                        <TextFormattingToolbar 
                                                            textareaRef={accentTextRef}
                                                            onTextChange={(newText) => updateCurrentSlide('accentText', newText)}
                                                        />
                                                        <AlignmentToggle 
                                                            value={currentSlide.accentAlign} 
                                                            onChange={(value) => updateCurrentSlide('accentAlign', value)} 
                                                        />
                                                    </div>
                                                </div>
                                                <textarea
                                                    ref={accentTextRef}
                                                    value={currentSlide.accentText || ''}
                                                    onChange={(e) => updateCurrentSlide('accentText', e.target.value)}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                    rows="3"
                                                    placeholder="–¢–µ–∫—Å—Ç –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è"
                                                />
                                            </div>
                                            
                                            <div>
                                                <div className="flex justify-between items-center mb-1">
                                                    <label className="block text-sm font-medium text-gray-600">
                                                        –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç
                                                    </label>
                                                    <div className="flex gap-2">
                                                        <TextFormattingToolbar 
                                                            textareaRef={secondaryTextRef}
                                                            onTextChange={(newText) => updateCurrentSlide('secondaryText', newText)}
                                                        />
                                                        <AlignmentToggle 
                                                            value={currentSlide.secondaryTextAlign} 
                                                            onChange={(value) => updateCurrentSlide('secondaryTextAlign', value)} 
                                                        />
                                                    </div>
                                                </div>
                                                <textarea
                                                    ref={secondaryTextRef}
                                                    value={currentSlide.secondaryText || ''}
                                                    onChange={(e) => updateCurrentSlide('secondaryText', e.target.value)}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                    rows="4"
                                                    placeholder="–¢–µ–∫—Å—Ç –ø–æ—Å–ª–µ –∞–∫—Ü–µ–Ω—Ç–∞"
                                                />
                                            </div>
                                        </div>
                                    </div>

                                    <div className="bg-gradient-to-br from-blue-50 to-indigo-50 p-4 rounded-lg border border-blue-100">
                                        <h3 className="font-semibold text-gray-700 mb-3 flex items-center gap-2">
                                            üìè –†–∞–∑–º–µ—Ä—ã —à—Ä–∏—Ñ—Ç–æ–≤
                                        </h3>
                                        
                                        <div className="space-y-4">
                                            <div>
                                                <FontSizeSlider
                                                    label="–†–∞–∑–º–µ—Ä –∑–∞–≥–æ–ª–æ–≤–∫–∞"
                                                    value={currentSlide.titleFontSize || 130}
                                                    onChange={(value) => {
                                                        updateCurrentSlide('titleFontSize', value);
                                                        markSettingChanged('titleFontSize');
                                                    }}
                                                    min={40}
                                                    max={150}
                                                />
                                                <ApplyButtons
                                                    settingKey="titleFontSize"
                                                    settingName="—Ä–∞–∑–º–µ—Ä –∑–∞–≥–æ–ª–æ–≤–∫–∞"
                                                    onApplyCurrent={() => {}}
                                                    onApplyAll={() => applyToCurrentAndFollowing({ titleFontSize: currentSlide.titleFontSize })}
                                                />
                                            </div>
                                            
                                            <div>
                                                <FontSizeSlider
                                                    label="–†–∞–∑–º–µ—Ä –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞"
                                                    value={currentSlide.mainFontSize || 75}
                                                    onChange={(value) => {
                                                        updateCurrentSlide('mainFontSize', value);
                                                        markSettingChanged('mainFontSize');
                                                    }}
                                                    min={16}
                                                    max={150}
                                                />
                                                <ApplyButtons
                                                    settingKey="mainFontSize"
                                                    settingName="—Ä–∞–∑–º–µ—Ä –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞"
                                                    onApplyCurrent={() => {}}
                                                    onApplyAll={() => applyToCurrentAndFollowing({ mainFontSize: currentSlide.mainFontSize })}
                                                />
                                            </div>
                                            
                                            <div>
                                                <FontSizeSlider
                                                    label="–†–∞–∑–º–µ—Ä –∞–∫—Ü–µ–Ω—Ç–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞"
                                                    value={currentSlide.accentFontSize || 70}
                                                    onChange={(value) => {
                                                        updateCurrentSlide('accentFontSize', value);
                                                        markSettingChanged('accentFontSize');
                                                    }}
                                                    min={24}
                                                    max={150}
                                                />
                                                <ApplyButtons
                                                    settingKey="accentFontSize"
                                                    settingName="—Ä–∞–∑–º–µ—Ä –∞–∫—Ü–µ–Ω—Ç–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞"
                                                    onApplyCurrent={() => {}}
                                                    onApplyAll={() => applyToCurrentAndFollowing({ accentFontSize: currentSlide.accentFontSize })}
                                                />
                                            </div>
                                        </div>
                                    </div>

                                    <div className="bg-gray-50 rounded-lg border border-gray-200">
                                        <button
                                            onClick={() => setIsStyleSectionOpen(!isStyleSectionOpen)}
                                            className="w-full p-4 flex items-center justify-between hover:bg-gray-100 transition-colors rounded-lg"
                                        >
                                            <h3 className="font-semibold text-gray-700 flex items-center gap-2">
                                                üé® –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ
                                            </h3>
                                            <span className="text-2xl">{isStyleSectionOpen ? '‚ñ≤' : '‚ñº'}</span>
                                        </button>
                                        
                                        {isStyleSectionOpen && (
                                            <div className="p-4 pt-0">
                                                <div className="space-y-3">
                                                    <div>
                                                        <label className="block text-sm font-medium text-gray-600 mb-1">
                                                            –¢–∏–ø —Ñ–æ–Ω–∞
                                                        </label>
                                                        <select
                                                            value={currentSlide.bgType || 'solid'}
                                                            onChange={(e) => {
                                                                updateCurrentSlide('bgType', e.target.value);
                                                            }}
                                                            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"
                                                        >
                                                            <option value="solid">–û–¥–Ω–æ—Ç–æ–Ω–Ω—ã–π</option>
                                                            <option value="gradient">–ì—Ä–∞–¥–∏–µ–Ω—Ç</option>
                                                            <option value="image">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</option>
                                                        </select>
                                                    </div>
                                                    
                                                    {(currentSlide.bgType || 'solid') === 'image' ? (
                                                        <div>
                                                            <label className="block text-sm font-medium text-gray-600 mb-2">
                                                                –§–æ–Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                                                            </label>
                                                            {currentSlide.bgImage ? (
                                                                <div className="space-y-3">
                                                                    <div className="relative w-full h-32 rounded-lg overflow-hidden border-2 border-gray-300">
                                                                        <img 
                                                                            src={currentSlide.bgImage} 
                                                                            alt="–§–æ–Ω" 
                                                                            className="w-full h-full object-cover"
                                                                        />
                                                                    </div>
                                                                    <button
                                                                        onClick={() => setShowDeleteModal(true)}
                                                                        className="w-full px-4 py-3 bg-gradient-to-r from-red-50 to-orange-50 text-red-700 rounded-lg hover:from-red-100 hover:to-orange-100 transition-all font-semibold border-2 border-red-300 flex items-center justify-center gap-2"
                                                                    >
                                                                        üîÑ –ò–∑–º–µ–Ω–∏—Ç—å —Ñ–æ–Ω
                                                                    </button>
                                                                </div>
                                                            ) : (
                                                                <>
                                                                    <input
                                                                        ref={fileInputRef}
                                                                        type="file"
                                                                        accept="image/*"
                                                                        onChange={handleImageSelect}
                                                                        className="hidden"
                                                                    />
                                                                    <button
                                                                        onClick={() => fileInputRef.current?.click()}
                                                                        className="w-full px-4 py-8 border-2 border-dashed border-blue-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-colors text-center font-semibold text-blue-600 flex flex-col items-center justify-center gap-2"
                                                                    >
                                                                        <span className="text-4xl">üìÅ</span>
                                                                        <span>–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ñ–æ–Ω–∞</span>
                                                                    </button>
                                                                </>
                                                            )}
                                                        </div>
                                                    ) : (
                                                        <div className="space-y-3">
                                                            <div>
                                                                <label className="block text-sm font-medium text-gray-600 mb-2">
                                                                    {(currentSlide.bgType || 'solid') === 'solid' ? '–¶–≤–µ—Ç —Ñ–æ–Ω–∞' : '–¶–≤–µ—Ç —Ñ–æ–Ω–∞ 1'}
                                                                </label>
                                                                <div className="flex gap-2">
                                                                    <input
                                                                        type="color"
                                                                        value={currentSlide.bgColor1 || '#1e40af'}
                                                                        onChange={(e) => {
                                                                            updateCurrentSlide('bgColor1', e.target.value);
                                                                            markSettingChanged('bgColor1');
                                                                        }}
                                                                        className="h-10 w-20 rounded border border-gray-300 cursor-pointer"
                                                                    />
                                                                    <input
                                                                        type="text"
                                                                        value={currentSlide.bgColor1 || '#1e40af'}
                                                                        onChange={(e) => {
                                                                            updateCurrentSlide('bgColor1', e.target.value);
                                                                            markSettingChanged('bgColor1');
                                                                        }}
                                                                        className="flex-1 px-2 py-1 border border-gray-300 rounded text-sm"
                                                                    />
                                                                </div>
                                                                <ApplyButtons
                                                                    settingKey="bgColor1"
                                                                    settingName="—Ü–≤–µ—Ç —Ñ–æ–Ω–∞"
                                                                    onApplyCurrent={() => {}}
                                                                    onApplyAll={() => applyToCurrentAndFollowing({ bgColor1: currentSlide.bgColor1 })}
                                                                />
                                                            </div>
                                                            
                                                            {(currentSlide.bgType || 'solid') === 'gradient' && (
                                                                <div>
                                                                    <label className="block text-sm font-medium text-gray-600 mb-2">
                                                                        –¶–≤–µ—Ç —Ñ–æ–Ω–∞ 2
                                                                    </label>
                                                                    <div className="flex gap-2">
                                                                        <input
                                                                            type="color"
                                                                            value={currentSlide.bgColor2 || '#7c3aed'}
                                                                            onChange={(e) => {
                                                                                updateCurrentSlide('bgColor2', e.target.value);
                                                                                markSettingChanged('bgColor2');
                                                                            }}
                                                                            className="h-10 w-20 rounded border border-gray-300 cursor-pointer"
                                                                        />
                                                                        <input
                                                                            type="text"
                                                                            value={currentSlide.bgColor2 || '#7c3aed'}
                                                                            onChange={(e) => {
                                                                                updateCurrentSlide('bgColor2', e.target.value);
                                                                                markSettingChanged('bgColor2');
                                                                            }}
                                                                            className="flex-1 px-2 py-1 border border-gray-300 rounded text-sm"
                                                                        />
                                                                    </div>
                                                                    <ApplyButtons
                                                                        settingKey="bgColor2"
                                                                        settingName="–≤—Ç–æ—Ä–æ–π —Ü–≤–µ—Ç —Ñ–æ–Ω–∞"
                                                                        onApplyCurrent={() => {}}
                                                                        onApplyAll={() => applyToCurrentAndFollowing({ bgColor2: currentSlide.bgColor2 })}
                                                                    />
                                                                </div>
                                                            )}
                                                        </div>
                                                    )}
                                                    
                                                    <div>
                                                        <label className="block text-sm font-medium text-gray-600 mb-2">
                                                            –¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞
                                                        </label>
                                                        <div className="flex gap-2">
                                                            <input
                                                                type="color"
                                                                value={currentSlide.textColor || '#ffffff'}
                                                                onChange={(e) => {
                                                                    updateCurrentSlide('textColor', e.target.value);
                                                                    markSettingChanged('textColor');
                                                                }}
                                                                className="h-10 w-20 rounded border border-gray-300 cursor-pointer"
                                                            />
                                                            <input
                                                                type="text"
                                                                value={currentSlide.textColor || '#ffffff'}
                                                                onChange={(e) => {
                                                                    updateCurrentSlide('textColor', e.target.value);
                                                                    markSettingChanged('textColor');
                                                                }}
                                                                className="flex-1 px-2 py-1 border border-gray-300 rounded text-sm"
                                                            />
                                                        </div>
                                                        <ApplyButtons
                                                            settingKey="textColor"
                                                            settingName="—Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞"
                                                            onApplyCurrent={() => {}}
                                                            onApplyAll={() => applyToCurrentAndFollowing({ textColor: currentSlide.textColor })}
                                                        />
                                                    </div>
                                                    
                                                    <div className="space-y-3 mt-4 pt-4 border-t border-gray-200">
                                                        <div>
                                                            <label className="block text-sm font-medium text-gray-600 mb-2">
                                                                –¶–≤–µ—Ç –∞–∫—Ü–µ–Ω—Ç–Ω–æ–π –ø–æ–¥–ª–æ–∂–∫–∏
                                                            </label>
                                                            <div className="flex gap-2">
                                                                <input
                                                                    type="color"
                                                                    value={currentSlide.accentBgColor || '#fbbf24'}
                                                                    onChange={(e) => {
                                                                        updateCurrentSlide('accentBgColor', e.target.value);
                                                                        markSettingChanged('accentBgColor');
                                                                    }}
                                                                    className="h-10 w-20 rounded border border-gray-300 cursor-pointer"
                                                                />
                                                                <input
                                                                    type="text"
                                                                    value={currentSlide.accentBgColor || '#fbbf24'}
                                                                    onChange={(e) => {
                                                                        updateCurrentSlide('accentBgColor', e.target.value);
                                                                        markSettingChanged('accentBgColor');
                                                                    }}
                                                                    className="flex-1 px-2 py-1 border border-gray-300 rounded text-sm"
                                                                />
                                                            </div>
                                                            <ApplyButtons
                                                                settingKey="accentBgColor"
                                                                settingName="—Ü–≤–µ—Ç –∞–∫—Ü–µ–Ω—Ç–Ω–æ–π –ø–æ–¥–ª–æ–∂–∫–∏"
                                                                onApplyCurrent={() => {}}
                                                                onApplyAll={() => applyToCurrentAndFollowing({ accentBgColor: currentSlide.accentBgColor })}
                                                            />
                                                        </div>
                                                        
                                                        <div>
                                                            <label className="block text-sm font-medium text-gray-600 mb-2">
                                                                –¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –Ω–∞ –∞–∫—Ü–µ–Ω—Ç–µ
                                                            </label>
                                                            <div className="flex gap-2">
                                                                <input
                                                                    type="color"
                                                                    value={currentSlide.accentTextColor || '#000000'}
                                                                    onChange={(e) => {
                                                                        updateCurrentSlide('accentTextColor', e.target.value);
                                                                        markSettingChanged('accentTextColor');
                                                                    }}
                                                                    className="h-10 w-20 rounded border border-gray-300 cursor-pointer"
                                                                />
                                                                <input
                                                                    type="text"
                                                                    value={currentSlide.accentTextColor || '#000000'}
                                                                    onChange={(e) => {
                                                                        updateCurrentSlide('accentTextColor', e.target.value);
                                                                        markSettingChanged('accentTextColor');
                                                                    }}
                                                                    className="flex-1 px-2 py-1 border border-gray-300 rounded text-sm"
                                                                />
                                                            </div>
                                                            <ApplyButtons
                                                                settingKey="accentTextColor"
                                                                settingName="—Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –Ω–∞ –∞–∫—Ü–µ–Ω—Ç–µ"
                                                                onApplyCurrent={() => {}}
                                                                onApplyAll={() => applyToCurrentAndFollowing({ accentTextColor: currentSlide.accentTextColor })}
                                                            />
                                                        </div>
                                                    </div>
                                                    
                                                    <div>
                                                        <label className="block text-sm font-medium text-gray-600 mb-1">
                                                            –®—Ä–∏—Ñ—Ç
                                                        </label>
                                                        <select
                                                            value={currentSlide.fontFamily || 'Inter'}
                                                            onChange={(e) => {
                                                                updateCurrentSlide('fontFamily', e.target.value);
                                                                markSettingChanged('fontFamily');
                                                            }}
                                                            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"
                                                        >
                                                            {fonts.map(font => (
                                                                <option key={font.name} value={font.name}>
                                                                    {font.name}
                                                                </option>
                                                            ))}
                                                        </select>
                                                        <ApplyButtons
                                                            settingKey="fontFamily"
                                                            settingName="—à—Ä–∏—Ñ—Ç"
                                                            onApplyCurrent={() => {}}
                                                            onApplyAll={() => applyToCurrentAndFollowing({ fontFamily: currentSlide.fontFamily })}
                                                        />
                                                    </div>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                    
                                    <div className="space-y-2">
                                        <button
                                            onClick={exportCurrentSlide}
                                            className="w-full bg-blue-600 text-white py-3 px-4 rounded-md hover:bg-blue-700 transition-colors flex items-center justify-center gap-2 font-medium shadow-md hover:shadow-lg"
                                        >
                                            ‚¨áÔ∏è –°–∫–∞—á–∞—Ç—å —Ç–µ–∫—É—â–∏–π —Å–ª–∞–π–¥
                                        </button>
                                        
                                        <button
                                            onClick={exportAllSlidesAsZip}
                                            disabled={isExporting}
                                            className="w-full bg-green-600 text-white py-3 px-4 rounded-md hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2 font-medium shadow-md hover:shadow-lg"
                                        >
                                            üì¶ –°–∫–∞—á–∞—Ç—å –≤—Å–µ —Å–ª–∞–π–¥—ã ZIP ({slides.length})
                                        </button>
                                        
                                        <button
                                            onClick={exportAllSlidesAsPDF}
                                            disabled={isExporting}
                                            className="w-full bg-purple-600 text-white py-3 px-4 rounded-md hover:bg-purple-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2 font-medium shadow-md hover:shadow-lg"
                                        >
                                            üìÑ –°–∫–∞—á–∞—Ç—å –≤—Å–µ —Å–ª–∞–π–¥—ã PDF ({slides.length})
                                        </button>
                                        
                                        <div className="pt-2 border-t border-gray-200">
                                            <button
                                                onClick={exportProjectToFile}
                                                className="w-full bg-gray-100 text-gray-600 py-3 px-4 rounded-md hover:bg-gray-200 transition-colors flex items-center justify-center gap-2 font-medium border border-gray-300"
                                            >
                                                üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–µ–∫—Ç –Ω–∞ –¥–∏—Å–∫
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div>
                                    <div className="sticky top-4">
                                        <label className="block text-sm font-medium text-gray-600 mb-2">
                                            –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Å–ª–∞–π–¥–∞ {currentSlideIndex + 1}
                                        </label>
                                        <div className="bg-gray-200 p-4 rounded-lg">
                                            <div
                                                ref={slideRef}
                                                className={`${getAspectRatioClass()} rounded-lg shadow-xl overflow-hidden`}
                                                style={getSlideBackground()}
                                            >
                                                <div className="h-full flex flex-col justify-center p-12">
                                                    {currentSlide.title && (
                                                        <h2
                                                            className={`font-bold mb-6 ${
                                                                currentSlide.titleAlign === 'left' ? 'self-start text-left' : 'self-center text-center'
                                                            }`}
                                                            style={{
                                                                fontFamily: fonts.find(f => f.name === (currentSlide.fontFamily || 'Inter'))?.value,
                                                                color: currentSlide.textColor || '#ffffff',
                                                                fontSize: `${(currentSlide.titleFontSize || 130) * 0.25}px`,
                                                                whiteSpace: 'pre-wrap'
                                                            }}
                                                        >
                                                            {currentSlide.title}
                                                        </h2>
                                                    )}
                                                    
                                                    {currentSlide.mainText && (
                                                        renderFormattedText(
                                                            currentSlide.mainText,
                                                            {
                                                                fontFamily: fonts.find(f => f.name === (currentSlide.fontFamily || 'Inter'))?.value,
                                                                color: currentSlide.textColor || '#ffffff',
                                                                opacity: 0.9,
                                                                fontSize: `${(currentSlide.mainFontSize || 75) * 0.25}px`
                                                            },
                                                            `mb-6 max-w-2xl ${currentSlide.mainTextAlign === 'left' ? 'self-start text-left' : 'self-center text-center'}`
                                                        )
                                                    )}
                                                    
                                                    {currentSlide.accentText && (
                                                        <div className={`mb-6 ${
                                                            currentSlide.accentAlign === 'left' ? 'self-start' : 'self-center'
                                                        }`}>
                                                            <div className="relative inline-block">
                                                                <div
                                                                    className="absolute inset-0 rounded-lg"
                                                                    style={{
                                                                        backgroundColor: currentSlide.accentBgColor || '#fbbf24',
                                                                        margin: `-${(currentSlide.accentFontSize || 70) * 0.15}px -${(currentSlide.accentFontSize || 70) * 0.3}px`
                                                                    }}
                                                                />
                                                                {renderFormattedText(
                                                                    currentSlide.accentText,
                                                                    {
                                                                        fontFamily: fonts.find(f => f.name === (currentSlide.fontFamily || 'Inter'))?.value,
                                                                        color: currentSlide.accentTextColor || '#000000',
                                                                        fontSize: `${(currentSlide.accentFontSize || 70) * 0.25}px`,
                                                                        padding: `${(currentSlide.accentFontSize || 70) * 0.15}px ${(currentSlide.accentFontSize || 70) * 0.3}px`,
                                                                        position: 'relative',
                                                                        fontWeight: '600'
                                                                    },
                                                                    ''
                                                                )}
                                                            </div>
                                                        </div>
                                                    )}
                                                    
                                                    {currentSlide.secondaryText && (
                                                        renderFormattedText(
                                                            currentSlide.secondaryText,
                                                            {
                                                                fontFamily: fonts.find(f => f.name === (currentSlide.fontFamily || 'Inter'))?.value,
                                                                color: currentSlide.textColor || '#ffffff',
                                                                opacity: 0.9,
                                                                fontSize: `${(currentSlide.mainFontSize || 75) * 0.25}px`
                                                            },
                                                            `max-w-2xl ${currentSlide.secondaryTextAlign === 'left' ? 'self-start text-left' : 'self-center text-center'}`
                                                        )
                                                    )}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<PresentationDesigner />, document.getElementById('root'));
    </script>
</body>
</html>

